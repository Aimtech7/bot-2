const _0x3a70e9=_0x42ea;(function(_0x3a1a30,_0x43e71c){const _0x511cac=_0x42ea,_0x4efc67=_0x3a1a30();while(!![]){try{const _0x10ae92=parseInt(_0x511cac(0x111))/(0x90a*-0x3+0x24e2+-0x9c3)+-parseInt(_0x511cac(0x1ac))/(0x2434+-0x1cc+-0x2266)+-parseInt(_0x511cac(0x161))/(-0xdad+0x742*0x1+-0x66e*-0x1)+parseInt(_0x511cac(0xd7))/(0x11ec*0x2+-0x1058*-0x2+-0xa*0x6da)*(parseInt(_0x511cac(0x114))/(-0x1*-0x8ea+-0xf*-0x17b+-0x1f1a))+parseInt(_0x511cac(0xc2))/(-0x200e+-0x21*-0x56+0x14fe)*(parseInt(_0x511cac(0x106))/(-0x22c3+-0x211f+0x487*0xf))+-parseInt(_0x511cac(0x1aa))/(-0x1610+0x3b*-0x89+-0x4e1*-0xb)+parseInt(_0x511cac(0x10d))/(0x595+0x1c*-0xaf+0x244*0x6);if(_0x10ae92===_0x43e71c)break;else _0x4efc67['push'](_0x4efc67['shift']());}catch(_0x2396e7){_0x4efc67['push'](_0x4efc67['shift']());}}}(_0xec8b,-0x109e78+0x66a6*0x31+0xaa8b0));import{info,warn,error}from'../utils/logger.js';import{downloadContentFromMessage,isJidGroup}from'@whiskeysockets/baileys';function _0x42ea(_0xb269f9,_0x63a27e){const _0xa1cd07=_0xec8b();return _0x42ea=function(_0x1ea3ab,_0x56ecf5){_0x1ea3ab=_0x1ea3ab-(0x1537+-0x4b*-0x4b+-0x1*0x2a8d);let _0x3d5e5e=_0xa1cd07[_0x1ea3ab];return _0x3d5e5e;},_0x42ea(_0xb269f9,_0x63a27e);}import{getConfig,hotReloadConfig}from'../utils/config.js';import{db}from'../utils/database.js';import{isSudo}from'../utils/sudo.js';import{getBotJid}from'../utils/bot-state.js';import{startManagedListener,stopManagedListener}from'../utils/listenerManager.js';export const name=_0x3a70e9(0x19a);export const version='2.0.0-patc'+_0x3a70e9(0xed);export const priority=-0xdf8*0x1+0xa*0x337+-0x11cf;export const commands=[_0x3a70e9(0x19a)];export const configKeys=['VIEWONCE_S'+_0x3a70e9(0x153)+_0x3a70e9(0x10b)+'_SOURCE',_0x3a70e9(0xc6)+_0x3a70e9(0xd9)+_0x3a70e9(0x115)+_0x3a70e9(0x16b)];let botRef=null,SKIP_IF_TARGET_EQUALS_SOURCE=!![],ALLOW_GROUP_COMMANDS_DEFAULT=![],MODE='p',TARGET_JID=null,ALLOW_GROUP_COMMANDS=ALLOW_GROUP_COMMANDS_DEFAULT,NOTIFY_VIEWONCE=![];function refreshConfig(){const _0x215db8=_0x3a70e9;try{const _0x8d9a66=getConfig()||{};SKIP_IF_TARGET_EQUALS_SOURCE=_0x8d9a66[_0x215db8(0x144)+_0x215db8(0x153)+_0x215db8(0x10b)+_0x215db8(0x10e)]!==undefined?Boolean(_0x8d9a66[_0x215db8(0x144)+_0x215db8(0x153)+'GET_EQUALS'+_0x215db8(0x10e)]):SKIP_IF_TARGET_EQUALS_SOURCE,ALLOW_GROUP_COMMANDS_DEFAULT=Boolean(_0x8d9a66[_0x215db8(0xc6)+_0x215db8(0xd9)+_0x215db8(0x115)+'DEFAULT']??ALLOW_GROUP_COMMANDS_DEFAULT),info('['+name+(']\x20config\x20r'+'efreshed'));}catch(_0x40fe82){warn('['+name+(']\x20refreshC'+'onfig\x20erro'+_0x215db8(0x1ad))+(_0x40fe82?.[_0x215db8(0x189)]||_0x40fe82));}}try{hotReloadConfig&&hotReloadConfig((_0x582224=[])=>{const _0x495b2b=_0x3a70e9,_0x39fce7=[_0x495b2b(0x144)+_0x495b2b(0x153)+_0x495b2b(0x10b)+_0x495b2b(0x10e),_0x495b2b(0xc6)+_0x495b2b(0xd9)+_0x495b2b(0x115)+_0x495b2b(0x16b)];if((_0x582224||[])[_0x495b2b(0x183)](_0x40e52d=>_0x39fce7['includes'](_0x40e52d)))refreshConfig();});}catch(_0x25d3f1){warn('['+name+(_0x3a70e9(0xaf)+_0x3a70e9(0xb9)+'gistration'+_0x3a70e9(0x100))+(_0x25d3f1?.[_0x3a70e9(0x189)]||_0x25d3f1));}refreshConfig();async function ensureSchema(){const _0x5caa2e=_0x3a70e9;try{await db[_0x5caa2e(0xf1)](_0x5caa2e(0x120)+_0x5caa2e(0xfc)+'IF\x20NOT\x20EXI'+'STS\x20viewon'+'ce_prefs\x20('+_0x5caa2e(0x140)+_0x5caa2e(0xf4)+_0x5caa2e(0x150)+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20v'+_0x5caa2e(0x102)+'NOT\x20NULL,\x0a'+_0x5caa2e(0x182)+_0x5caa2e(0xa7)+'NTEGER\x20DEF'+_0x5caa2e(0x1a9)+_0x5caa2e(0x172));try{const _0x19d61b=await db[_0x5caa2e(0xf7)](_0x5caa2e(0x184)+_0x5caa2e(0xb2)+_0x5caa2e(0xe3)+_0x5caa2e(0x110)+_0x5caa2e(0xe0));MODE=_0x19d61b?.['value']==='g'?'g':'p';}catch(_0x98719a){}try{const _0x477201=await db['get'](_0x5caa2e(0x184)+_0x5caa2e(0xb2)+_0x5caa2e(0xe3)+_0x5caa2e(0x110)+'ey=\x27target'+'_jid\x27');TARGET_JID=_0x477201?.[_0x5caa2e(0x1a5)]||null;}catch(_0x10c87d){TARGET_JID=null;}try{const _0x495702=await db[_0x5caa2e(0xf7)](_0x5caa2e(0x184)+'ue\x20FROM\x20vi'+_0x5caa2e(0xe3)+_0x5caa2e(0x110)+_0x5caa2e(0x125)+'group_comm'+_0x5caa2e(0xb3));ALLOW_GROUP_COMMANDS=_0x495702?.[_0x5caa2e(0x1a5)]==='1';}catch(_0x439518){ALLOW_GROUP_COMMANDS=ALLOW_GROUP_COMMANDS_DEFAULT;}try{const _0x3efcbe=await db['get'](_0x5caa2e(0x184)+_0x5caa2e(0xb2)+_0x5caa2e(0xe3)+'fs\x20WHERE\x20k'+'ey=\x27notify'+'_viewonce\x27');NOTIFY_VIEWONCE=_0x3efcbe?.[_0x5caa2e(0x1a5)]==='1';}catch(_0x2815ac){NOTIFY_VIEWONCE=![];}info('['+name+(_0x5caa2e(0x16d)+_0x5caa2e(0x142))+MODE+_0x5caa2e(0x17a)+(TARGET_JID||_0x5caa2e(0x167))+_0x5caa2e(0xd0)+NOTIFY_VIEWONCE+(',\x20allow_gr'+_0x5caa2e(0x14f)+_0x5caa2e(0x18e))+ALLOW_GROUP_COMMANDS+')');}catch(_0x4acbe5){error(_0x4acbe5,'['+name+(_0x5caa2e(0x147)+'hema\x20faile'+'d'));throw _0x4acbe5;}}async function savePref(_0x14c571,_0x5ec897){const _0xd79824=_0x3a70e9;try{const _0x5ce09a=Math[_0xd79824(0x104)](Date[_0xd79824(0x18a)]()/(-0x301*0x2+0x920+0xca));await db[_0xd79824(0xef)](_0xd79824(0x12b)+_0xd79824(0x14b)+_0xd79824(0xd5)+_0xd79824(0x11b)+_0xd79824(0xa9)+_0xd79824(0x13c)+_0xd79824(0x166)+_0xd79824(0xe9)+'ey)\x20DO\x20UPD'+_0xd79824(0xba)+_0xd79824(0x143)+'ed.value,\x20'+_0xd79824(0x170)+_0xd79824(0xd3)+_0xd79824(0x170),[_0x14c571,_0x5ec897,_0x5ce09a]);}catch(_0x351324){return warn('['+name+(_0xd79824(0xdd)+_0xd79824(0x180)+_0xd79824(0x191)+'r\x20')+_0x14c571+'='+_0x5ec897+_0xd79824(0x122)+(_0x351324?.[_0xd79824(0x189)]||_0x351324)),![];}try{const _0x2ce3af=await db[_0xd79824(0xf7)](_0xd79824(0x184)+'ue\x20FROM\x20vi'+_0xd79824(0xe3)+_0xd79824(0x110)+_0xd79824(0x1b2),[_0x14c571]),_0x3ef3d7=_0x2ce3af?.[_0xd79824(0x1a5)]??_0x5ec897;if(_0x14c571==='mode')MODE=_0x3ef3d7==='g'?'g':'p';if(_0x14c571===_0xd79824(0xa4))TARGET_JID=_0x3ef3d7||null;if(_0x14c571===_0xd79824(0xf6)+_0xd79824(0x1a3))ALLOW_GROUP_COMMANDS=_0x3ef3d7==='1';if(_0x14c571===_0xd79824(0x15f)+_0xd79824(0x1b1))NOTIFY_VIEWONCE=_0x3ef3d7==='1';return info('['+name+(_0xd79824(0x164)+_0xd79824(0x171)+_0xd79824(0x175))+_0x14c571+'='+_0x3ef3d7),!![];}catch(_0x10a73a){warn('['+name+(_0xd79824(0xdd)+_0xd79824(0x1a0)+'fter\x20write'+'\x20failed\x20fo'+'r\x20')+_0x14c571+'='+_0x5ec897+_0xd79824(0x122)+(_0x10a73a?.['message']||_0x10a73a));if(_0x14c571===_0xd79824(0x13b))MODE=_0x5ec897==='g'?'g':'p';if(_0x14c571===_0xd79824(0xa4))TARGET_JID=_0x5ec897||null;if(_0x14c571===_0xd79824(0xf6)+'p_commands')ALLOW_GROUP_COMMANDS=_0x5ec897==='1';if(_0x14c571===_0xd79824(0x15f)+_0xd79824(0x1b1))NOTIFY_VIEWONCE=_0x5ec897==='1';return!![];}}function normalizeToUserJid(_0x102f56){const _0x47edd7=_0x3a70e9;try{if(!_0x102f56||typeof _0x102f56!==_0x47edd7(0x131))return _0x102f56;const _0x2a6ddc=_0x102f56['indexOf']('@');if(_0x2a6ddc===-(0x116a+0x11a+-0x1283*0x1))return _0x102f56;const _0x4d5fce=_0x102f56['slice'](0x2af*0x2+0x22c3*0x1+0x1*-0x2821,_0x2a6ddc),_0x8cfa0=_0x102f56[_0x47edd7(0x199)](_0x2a6ddc),_0x5d808c=_0x4d5fce['indexOf'](':');if(_0x5d808c===-(-0x11cc+-0x6d*-0x23+-0x6a*-0x7))return _0x102f56;return _0x4d5fce[_0x47edd7(0x199)](0xd27+0x2002+-0x2d29,_0x5d808c)+_0x8cfa0;}catch(_0xbf874a){return _0x102f56;}}async function trySend(_0x1a93c9,_0xb2125f){const _0x1a3920=_0x3a70e9;try{const _0x251690=normalizeToUserJid(String(_0x1a93c9));if(!_0x251690)throw new Error(_0x1a3920(0xc1)+_0x1a3920(0x108));if(typeof botRef?.[_0x1a3920(0xe7)+'e']==='function'){await botRef[_0x1a3920(0xe7)+'e'](_0x251690,_0xb2125f);return;}if(botRef?.['sock']&&typeof botRef['sock'][_0x1a3920(0xe7)+'e']===_0x1a3920(0xb6)){await botRef[_0x1a3920(0x101)][_0x1a3920(0xe7)+'e'](_0x251690,_0xb2125f);return;}throw new Error(_0x1a3920(0xfe)+_0x1a3920(0x196)+_0x1a3920(0x12c));}catch(_0x4d5a85){throw _0x4d5a85;}}const DEDUPE_TTL_MS=(0xfb6+-0x487+0x3*-0x3b7)*(-0x3a7+0x68a+0x1d*0x9),processedKeys=new Map();function markProcessed(_0x9c98d6){const _0x4999e6=_0x3a70e9;if(!_0x9c98d6)return;if(processedKeys['has'](_0x9c98d6))try{clearTimeout(processedKeys[_0x4999e6(0xf7)](_0x9c98d6));}catch(_0x5c16b7){}const _0x502b76=setTimeout(()=>processedKeys[_0x4999e6(0x1a8)](_0x9c98d6),DEDUPE_TTL_MS);processedKeys[_0x4999e6(0x149)](_0x9c98d6,_0x502b76);}function isProcessed(_0x22a291){const _0x42ba66=_0x3a70e9;return _0x22a291&&processedKeys[_0x42ba66(0xec)](_0x22a291);}function extractContextInfo(_0x2ca534){const _0x1a8cc4=_0x3a70e9;if(!_0x2ca534||!_0x2ca534['message'])return null;const _0x388787=_0x2ca534['message'];return _0x388787[_0x1a8cc4(0xa3)+_0x1a8cc4(0xae)]?.[_0x1a8cc4(0xb4)+'o']||_0x388787[_0x1a8cc4(0xb4)+'o']||null;}function extractViewOnceInnerFromQuoted(_0xccb0dc){const _0xaed26f=_0x3a70e9;if(!_0xccb0dc)return null;return _0xccb0dc?.[_0xaed26f(0x13f)+_0xaed26f(0x165)]?.['message']||_0xccb0dc?.[_0xaed26f(0x13f)+_0xaed26f(0x17c)]?.[_0xaed26f(0x189)]||(_0xccb0dc[_0xaed26f(0x192)+'ge']?_0xccb0dc:null)||(_0xccb0dc['videoMessa'+'ge']?_0xccb0dc:null)||null;}function getSelfJid(){return getBotJid()||null;}function resolveDestination(_0x349c52){const _0x460be5=getSelfJid();if(MODE==='g'&&TARGET_JID){if(SKIP_IF_TARGET_EQUALS_SOURCE&&TARGET_JID===_0x349c52)return _0x460be5;return TARGET_JID;}return _0x460be5;}function stripDomain(_0x4cd832){const _0x53b5af=_0x3a70e9;if(!_0x4cd832||typeof _0x4cd832!==_0x53b5af(0x131))return _0x4cd832;const _0x27778d=_0x4cd832[_0x53b5af(0xfd)]('@');if(_0x27778d===-(-0x2133+-0x8cb*0x3+0x883*0x7))return _0x4cd832;return _0x4cd832[_0x53b5af(0x199)](-0x1635+0x1f7d+-0x948,_0x27778d);}async function handleUpsertSingle(_0xef7a78){const _0x92d77d=_0x3a70e9;try{if(!_0xef7a78||!_0xef7a78[_0x92d77d(0x13e)])return;if(_0xef7a78[_0x92d77d(0x13e)]?.[_0x92d77d(0x1b0)]===_0x92d77d(0xdb)+_0x92d77d(0xbc))return;if(Boolean(_0xef7a78[_0x92d77d(0x13e)]?.[_0x92d77d(0xfa)]))return;const _0x576432=String(_0xef7a78[_0x92d77d(0x13e)]['remoteJid']||'')+'::'+String(_0xef7a78[_0x92d77d(0x13e)]['id']||'');if(isProcessed(_0x576432))return;markProcessed(_0x576432);const _0x228e3d=Boolean(_0xef7a78[_0x92d77d(0x13e)]?.[_0x92d77d(0x16a)]),_0x5db390=Boolean(_0xef7a78[_0x92d77d(0x189)]?.[_0x92d77d(0x13f)+'ssage']||_0xef7a78[_0x92d77d(0x189)]?.[_0x92d77d(0x13f)+_0x92d77d(0x17c)]);if(!_0x228e3d&&!_0x5db390)return;if(!NOTIFY_VIEWONCE)return;const _0x5318fe=_0xef7a78[_0x92d77d(0x1af)]||_0xef7a78[_0x92d77d(0x13e)]?.[_0x92d77d(0xd1)+'t']||_0xef7a78[_0x92d77d(0x13e)]?.[_0x92d77d(0x1b0)]||null,_0x5f1585=_0x5318fe?stripDomain(String(_0x5318fe)):_0x92d77d(0x11f),_0x47c48c=_0xef7a78[_0x92d77d(0x13e)]?.[_0x92d77d(0x1b0)]?stripDomain(_0xef7a78[_0x92d77d(0x13e)]['remoteJid']):_0x92d77d(0x148)+'at',_0x3bb85f=resolveDestination(_0xef7a78[_0x92d77d(0x13e)]?.['remoteJid']);if(!_0x3bb85f)return;const _0x2c08d6=_0x92d77d(0x1a6)+_0x92d77d(0x188)+_0x92d77d(0xf8)+_0x5f1585+'\x20in\x20chat\x20'+_0x47c48c+('.\x0aReply\x20to'+'\x20that\x20mess'+_0x92d77d(0x10f)+_0x92d77d(0xc5)+_0x92d77d(0xcf)+_0x92d77d(0xe5)+_0x92d77d(0xdf)+_0x92d77d(0x141)+_0x92d77d(0x156)+_0x92d77d(0x178));try{await trySend(_0x3bb85f,{'text':_0x2c08d6}),info('['+name+(']\x20Notified'+'\x20')+_0x3bb85f+('\x20of\x20view-o'+'nce\x20from\x20')+_0x5f1585+_0x92d77d(0x1a2)+_0x47c48c);}catch(_0xabe101){warn('['+name+(_0x92d77d(0x126)+_0x92d77d(0xad)+':\x20')+(_0xabe101?.[_0x92d77d(0x189)]||_0xabe101));}}catch(_0x2ecc05){warn('['+name+(_0x92d77d(0x16f)+_0x92d77d(0x107)+_0x92d77d(0x163))+(_0x2ecc05?.[_0x92d77d(0x189)]||_0x2ecc05));}}async function upsertHandler({messages:_0x3b9fd4}){const _0x37614b=_0x3a70e9;try{if(!Array[_0x37614b(0x190)](_0x3b9fd4))return;for(const _0x3b01ea of _0x3b9fd4)await handleUpsertSingle(_0x3b01ea);}catch(_0x4d5d68){warn('['+name+(']\x20upsertHa'+_0x37614b(0x176)+_0x37614b(0x1ad))+(_0x4d5d68?.[_0x37614b(0x189)]||_0x4d5d68));}}async function downloadBufferFromContent(_0x2cf069,_0x586538){const _0x3947ef=_0x3a70e9;try{if(!_0x2cf069||!_0x586538)return null;const _0xa91b67=await downloadContentFromMessage(_0x2cf069,_0x586538);if(!_0xa91b67)return null;const _0x4cf6cf=[];for await(const _0x26ea8e of _0xa91b67){_0x4cf6cf[_0x3947ef(0x129)](_0x26ea8e);}if(!_0x4cf6cf['length'])return null;return Buffer[_0x3947ef(0xf0)](_0x4cf6cf);}catch(_0x354959){return warn('['+name+(_0x3947ef(0x15b)+_0x3947ef(0xdc)+_0x3947ef(0xca)+_0x3947ef(0xa5))+(_0x354959?.['message']||_0x354959)),null;}}async function forwardRecoveredToDest(_0x4a53b9,_0x493834,_0x4385e2,_0x2eed93){const _0xdc61eb=_0x3a70e9,_0x507e18=resolveDestination(_0x4385e2);if(!_0x507e18)return warn('['+name+(_0xdc61eb(0x12a)+'nation\x20res'+_0xdc61eb(0xee))),![];try{const _0x314bd0=_0x4a53b9?.['imageMessa'+'ge']?.[_0xdc61eb(0xce)]||_0x4a53b9?.['videoMessa'+'ge']?.['caption']||'',_0x5aaec5=_0x2eed93?stripDomain(_0x2eed93):_0xdc61eb(0x157)+'er',_0x54359e=_0x4385e2?stripDomain(_0x4385e2):_0xdc61eb(0x148)+'at',_0x13972b='\x0a\x0afrom:\x20'+_0x5aaec5+_0xdc61eb(0x1a2)+_0x54359e,_0x54b740=_0xdc61eb(0x197)+_0xdc61eb(0x194)+_0x314bd0+_0x13972b;if(_0x4a53b9[_0xdc61eb(0x192)+'ge'])return await trySend(_0x507e18,{'image':_0x493834,'caption':_0x54b740}),info('['+name+(_0xdc61eb(0x151)+_0xdc61eb(0xf9)+_0xdc61eb(0x17d))+_0x507e18),!![];if(_0x4a53b9['videoMessa'+'ge']){const _0x55fe9d=Boolean(_0x4a53b9[_0xdc61eb(0xe1)+'ge']?.[_0xdc61eb(0xa6)+'k']);return await trySend(_0x507e18,{'video':_0x493834,'caption':_0x54b740,'gifPlayback':_0x55fe9d}),info('['+name+(']\x20Sent\x20rec'+_0xdc61eb(0xff)+_0xdc61eb(0xd4))+_0x507e18),!![];}return await trySend(_0x507e18,{'document':_0x493834,'fileName':_0xdc61eb(0x15d)+_0xdc61eb(0x136),'mimetype':_0xdc61eb(0xb5)+'n/octet-st'+_0xdc61eb(0xc3),'caption':_0x54b740}),info('['+name+(']\x20Sent\x20rec'+_0xdc61eb(0x11d)+_0xdc61eb(0x12f))+_0x507e18),!![];}catch(_0x8bcbc9){return warn('['+name+(_0xdc61eb(0x112)+_0xdc61eb(0x18c)+_0xdc61eb(0x19c)+_0xdc61eb(0xd8))+(_0x8bcbc9?.[_0xdc61eb(0x189)]||_0x8bcbc9)),![];}}function extractTextFromCtx(_0x5a2fc8){const _0x598c94=_0x3a70e9;if(!_0x5a2fc8||!_0x5a2fc8[_0x598c94(0x189)])return'';const _0x251761=_0x5a2fc8[_0x598c94(0x189)];return _0x251761[_0x598c94(0x159)+'on']||_0x251761[_0x598c94(0xa3)+'xtMessage']?.[_0x598c94(0xcd)]||_0x251761[_0x598c94(0x192)+'ge']?.[_0x598c94(0xce)]||_0x251761[_0x598c94(0xe1)+'ge']?.[_0x598c94(0xce)]||'';}const processedCmdKeys=new Map(),CMD_DEDUPE_TTL_MS=(0x1eb3*0x1+-0x235*-0x4+-0x2769)*(0x1*0x20bf+-0x1*-0x8d3+0xc8e*-0x3);function markCmdProcessed(_0x4747b6){const _0x538191=_0x3a70e9;if(!_0x4747b6)return;if(processedCmdKeys[_0x538191(0xec)](_0x4747b6))try{clearTimeout(processedCmdKeys[_0x538191(0xf7)](_0x4747b6));}catch(_0x325565){};const _0x3b7d0d=setTimeout(()=>processedCmdKeys['delete'](_0x4747b6),CMD_DEDUPE_TTL_MS);processedCmdKeys[_0x538191(0x149)](_0x4747b6,_0x3b7d0d);}function isCmdProcessed(_0x21c578){return _0x21c578&&processedCmdKeys['has'](_0x21c578);}function _0xec8b(){const _0x5534d1=['ng\x20back\x20to','GET_EQUALS','get\x20JID.','7299063bbDIFz','_SOURCE','age\x20with\x20a','fs\x20WHERE\x20k','1047926GoSMSY',']\x20forwardR','toLowerCas','1802930SKbTbl','_COMMANDS_','group','essage\x20did','isCommand','e\x20handler\x20','\x20-\x20attempt','y,value,up','\x20group:\x20','overed\x20doc','ions\x20are\x20c','unknown','\x0a\x20\x20\x20\x20\x20\x20CRE','Configured','\x20‚Äî\x20','in\x20a\x20view-','\x20Mode\x20set\x20','ey=\x27allow_',']\x20notify\x20s','wId','video','push',']\x20no\x20desti','INSERT\x20INT','able','singleSele','\x20save\x20noti','ument\x20to\x20','@g.us','string','\x20Notificat','viewonce.i',':\x20reply\x20to','catch','bin','D*:\x20`','No\x20target\x20','*Target\x20JI','underscore','mode','VALUES\x20(?,','at\x20starts\x20','key','viewOnceMe','\x0a\x20\x20\x20\x20\x20\x20\x20\x20k','ore)\x20to\x20at','\x20(mode=','lue=exclud','VIEWONCE_S','\x20Failed\x20to','o\x20download',']\x20ensureSc','unknown\x20ch','set','[viewonce]','O\x20viewonce','alized\x20lis','et\x20JID:\x20','clear','oup_comman','IMARY\x20KEY,',']\x20Sent\x20rec','remove','KIP_IF_TAR','d\x20media\x20ty',']\x20initiali','tempt\x20reco','unknown\x20us','once\x20Setti','conversati','message\x20th',']\x20download','rting\x20comm','recovered.','ngs\x20(PM-On','notify_vie','\x20set\x20mode.','3877230eBGCBk','rmation\x20ta','\x20error:\x20',']\x20pref\x20sav','ssage','\x20?,\x20?)\x20ON\x20','unset','D\x20saved:\x20','error:\x20','isViewOnce','DEFAULT','\x20notify\x20on',']\x20DB\x20ready','OFF',']\x20handleUp','updated_at','ed\x20&\x20reloa','\x20\x20\x20);\x0a\x20\x20\x20\x20','listRespon',']\x20no\x20confi','ded:\x20','ndler\x20erro','ia\x20buffer','very.','ions\x20set\x20t',',\x20target=','\x20ctx.key.r','ssageV2','ge\x20to\x20','age','nitialize\x20',':\x20DB\x20write','notify','\x20\x20\x20\x20\x20\x20\x20\x20up','some','SELECT\x20val','*Anti-View','add','once\x20messa','\x20view-once','message','now','fications\x20','ecoveredTo','JID\x20set.','ds=','once\x20inner','isArray','\x20failed\x20fo','imageMessa','iew-once\x20i','Recovered\x0a','ned\x20false','sage\x20avail','View-Once\x20','\x20the\x20view-','slice','viewonce','ot\x20instanc','Dest\x20faile','ttonId','\x20Target\x20JI','\x20clear\x20tar',':\x20reload\x20a','ponseMessa','\x20in\x20','p_commands',']\x20quoted\x20v','value','üëÅÔ∏è\x20Detected','o\x20*','delete','AULT\x200\x0a\x20\x20\x20','12414952fhbWxl','nner\x20is\x20no','1495074DuPfTY','r:\x20','\x20not\x20conta','pushName','remoteJid','wonce','ey=?','extendedTe','target_jid','ror:\x20','gifPlaybac','dated_at\x20I','ctReply','dated_at)\x20','Not\x20set',']\x20cleanup\x20','charAt','end\x20failed','xtMessage',']\x20hotReloa','trim','Dest\x20retur','ue\x20FROM\x20vi','ands\x27','contextInf','applicatio','function','values','zed\x20(centr','dConfig\x20re','ATE\x20SET\x20va','selectedRo','adcast','messages.u','To\x20recover','selectedBu','`\x20`viewonc','no\x20send\x20ta','3096294WJWhCP','ream','\x20save\x20targ','\x20message\x20t','VIEWONCE_A','arts\x20with\x20','\x20inner\x20med','mmand\x20erro','Content\x20er','t\x20supporte','ions*:\x20','text','caption','hat\x20*start',',\x20notify=','participan','split','=excluded.','eo\x20to\x20','_prefs\x20(ke','quotedMess','12FhTosx','d:\x20','LLOW_GROUP','buttonsRes','status@bro','BufferFrom',']\x20savePref','includes','\x27\x20(undersc','ey=\x27mode\x27','videoMessa','seMessage','ewonce_pre','rget\x20-\x20abo','s\x20with*\x20\x27_','to\x20PM.','sendMessag','et*:\x20','CONFLICT(k',']\x20command\x20','e\x20<jid>`\x0a','has','hed','olved','run','concat','exec',']\x20quoted\x20m','image','ey\x20TEXT\x20PR','GROUP\x20(','allow_grou','get','\x20from\x20','overed\x20ima','fromMe','d\x20unavaila','ATE\x20TABLE\x20','indexOf','no\x20sendMes','overed\x20vid','\x20failed:\x20','sock','alue\x20TEXT\x20','D\x20cleared.','floor','\x20cleaned\x20u','21ZObFii','sertSingle','rget','endsWith'];_0xec8b=function(){return _0x5534d1;};return _0xec8b();}const recentResponded=new Set();export async function onMessage(_0x5e4549){const _0x146b4f=_0x3a70e9;try{if(!_0x5e4549||!_0x5e4549['key']||!_0x5e4549[_0x146b4f(0x189)])return;const _0x5848d7=_0x5e4549[_0x146b4f(0x13e)]?.['id']||null;if(_0x5848d7){if(recentResponded[_0x146b4f(0xec)](_0x5848d7))return;recentResponded[_0x146b4f(0x186)](_0x5848d7),setTimeout(()=>recentResponded[_0x146b4f(0x1a8)](_0x5848d7),(0x15*0x37+-0x176e+0x1327*0x1)*(-0x1*0x22bd+-0xc93+-0x4*-0xcce));}if(_0x5e4549[_0x146b4f(0x118)]){const _0x48be72=_0x5e4549['key'][_0x146b4f(0x1b0)],_0x4e8afe=typeof _0x48be72==='string'&&_0x48be72[_0x146b4f(0x109)](_0x146b4f(0x130));if(_0x4e8afe&&!ALLOW_GROUP_COMMANDS){}else{const _0x3265fc=Boolean(_0x5e4549['key'][_0x146b4f(0xfa)]);if(!_0x4e8afe&&!_0x3265fc){const _0x32192c=await isSudo(botRef,_0x5e4549)[_0x146b4f(0x135)](()=>![]);if(!_0x32192c){}else await handleCommand(_0x5e4549)[_0x146b4f(0x135)](_0x4867ff=>warn('['+name+(_0x146b4f(0xea)+'error:\x20')+(_0x4867ff?.[_0x146b4f(0x189)]||_0x4867ff)));}else{const _0x118a3f=await isSudo(botRef,_0x5e4549)[_0x146b4f(0x135)](()=>![]),_0x19a624=Boolean(_0x5e4549[_0x146b4f(0x13e)][_0x146b4f(0xfa)]);(_0x19a624||_0x118a3f)&&await handleCommand(_0x5e4549)[_0x146b4f(0x135)](_0x5b9cf0=>warn('['+name+(_0x146b4f(0xea)+_0x146b4f(0x169))+(_0x5b9cf0?.[_0x146b4f(0x189)]||_0x5b9cf0)));}}}const _0x442340=extractContextInfo(_0x5e4549);if(!_0x442340||!_0x442340[_0x146b4f(0xd6)+_0x146b4f(0x17e)])return;const _0x46a8dc=extractTextFromCtx(_0x5e4549)||'';if(!_0x46a8dc)return;const _0x5c8df0=_0x46a8dc[_0x146b4f(0xb0)]()[_0x146b4f(0xac)](0xfa+0x1e65*-0x1+0x1bb*0x11);if(_0x5c8df0!=='_')return;info('['+name+(']\x20Reply\x20st'+_0x146b4f(0xc7)+'underscore'+_0x146b4f(0x11a)+'ing\x20recove'+'ry'));const _0x3524df=extractViewOnceInnerFromQuoted(_0x442340[_0x146b4f(0xd6)+'age']);if(!_0x3524df){warn('['+name+(_0x146b4f(0xf2)+_0x146b4f(0x117)+_0x146b4f(0x1ae)+_0x146b4f(0x123)+_0x146b4f(0x18f)+'\x20message'));return;}let _0x30d7f2=null,_0x325265=null;if(_0x3524df['imageMessa'+'ge'])_0x30d7f2=_0x3524df[_0x146b4f(0x192)+'ge'],_0x325265=_0x146b4f(0xf3);else _0x3524df[_0x146b4f(0xe1)+'ge']&&(_0x30d7f2=_0x3524df[_0x146b4f(0xe1)+'ge'],_0x325265=_0x146b4f(0x128));if(!_0x30d7f2||!_0x325265){warn('['+name+(_0x146b4f(0x1a4)+_0x146b4f(0x193)+_0x146b4f(0x1ab)+_0x146b4f(0xcb)+_0x146b4f(0x154)+'pe'));return;}const _0x9011f1=await downloadBufferFromContent(_0x30d7f2,_0x325265);if(!_0x9011f1){warn('['+name+(']\x20failed\x20t'+_0x146b4f(0x146)+_0x146b4f(0xc8)+_0x146b4f(0x177)));return;}const _0xc80ece=_0x5e4549[_0x146b4f(0x13e)][_0x146b4f(0x1b0)]||null,_0x43702d=_0x442340[_0x146b4f(0xd1)+'t']||null,_0x55bbb7=await forwardRecoveredToDest(_0x3524df,_0x9011f1,_0xc80ece,_0x43702d);if(!_0x55bbb7)warn('['+name+(_0x146b4f(0x112)+_0x146b4f(0x18c)+_0x146b4f(0xb1)+_0x146b4f(0x195)));}catch(_0x416a80){error(_0x416a80,'['+name+(']\x20onMessag'+_0x146b4f(0x119)+_0x146b4f(0x169))+(_0x416a80?.[_0x146b4f(0x189)]||_0x416a80));}}async function handleCommand(_0xfc3e43){const _0x53d808=_0x3a70e9;try{if(!_0xfc3e43||!_0xfc3e43[_0x53d808(0x13e)]||!_0xfc3e43[_0x53d808(0x189)])return;const _0x5b0b1b=_0xfc3e43[_0x53d808(0x13e)][_0x53d808(0x1b0)],_0x41590e=typeof _0x5b0b1b===_0x53d808(0x131)&&_0x5b0b1b['endsWith'](_0x53d808(0x130));if(_0x41590e&&!ALLOW_GROUP_COMMANDS)return;const _0x2d0c56=Boolean(_0xfc3e43[_0x53d808(0x13e)][_0x53d808(0xfa)]);if(!_0x41590e&&!_0x2d0c56){const _0xa88fce=await isSudo(botRef,_0xfc3e43)['catch'](()=>![]);if(!_0xa88fce)return;}const _0x37f90b=Boolean(_0xfc3e43[_0x53d808(0x13e)][_0x53d808(0xfa)]),_0x3674ce=await isSudo(botRef,_0xfc3e43)[_0x53d808(0x135)](()=>![]);let _0x5ee465;if(_0x37f90b)_0x5ee465=getBotJid()||_0xfc3e43[_0x53d808(0x13e)][_0x53d808(0x1b0)]||_0xfc3e43['key'][_0x53d808(0xd1)+'t']||null,!_0x5ee465&&(warn('['+name+(']\x20getBotJi'+_0x53d808(0xfb)+'ble;\x20falli'+_0x53d808(0x10a)+_0x53d808(0x17b)+'emoteJid')),_0x5ee465=_0xfc3e43[_0x53d808(0x13e)][_0x53d808(0x1b0)]||null);else{if(_0x3674ce)_0x5ee465=_0xfc3e43[_0x53d808(0x13e)][_0x53d808(0x1b0)];else return;}if(!_0x5ee465){warn('['+name+(_0x53d808(0x174)+_0x53d808(0x162)+_0x53d808(0xe4)+_0x53d808(0x15c)+'and'));return;}const _0x41d548=String(_0xfc3e43[_0x53d808(0x13e)][_0x53d808(0x1b0)]||'')+'::'+String(_0xfc3e43[_0x53d808(0x13e)]['id']||_0xfc3e43[_0x53d808(0x13e)][_0x53d808(0xd1)+'t']||'');if(isCmdProcessed(_0x41d548))return;markCmdProcessed(_0x41d548);const _0xcab90a=typeof _0xfc3e43[_0x53d808(0xcd)]===_0x53d808(0x131)&&_0xfc3e43['text']['trim']()['length']?_0xfc3e43[_0x53d808(0xcd)][_0x53d808(0xb0)]():function _0x15f4a3(_0xb4dad2){const _0x5caabb=_0x53d808;if(!_0xb4dad2||!_0xb4dad2[_0x5caabb(0x189)])return'';const _0x441734=_0xb4dad2['message'];if(_0x441734[_0x5caabb(0x159)+'on'])return _0x441734[_0x5caabb(0x159)+'on'];if(_0x441734['extendedTe'+_0x5caabb(0xae)]?.[_0x5caabb(0xcd)])return _0x441734[_0x5caabb(0xa3)+_0x5caabb(0xae)][_0x5caabb(0xcd)];if(_0x441734[_0x5caabb(0x192)+'ge']?.[_0x5caabb(0xce)])return _0x441734['imageMessa'+'ge'][_0x5caabb(0xce)];if(_0x441734[_0x5caabb(0xe1)+'ge']?.[_0x5caabb(0xce)])return _0x441734[_0x5caabb(0xe1)+'ge'][_0x5caabb(0xce)];if(_0x441734[_0x5caabb(0xda)+_0x5caabb(0x1a1)+'ge']?.[_0x5caabb(0xbf)+'ttonId'])return _0x441734[_0x5caabb(0xda)+_0x5caabb(0x1a1)+'ge'][_0x5caabb(0xbf)+_0x5caabb(0x19d)];if(_0x441734[_0x5caabb(0x173)+_0x5caabb(0xe2)]?.[_0x5caabb(0x12d)+_0x5caabb(0xa8)]?.[_0x5caabb(0xbb)+_0x5caabb(0x127)])return _0x441734[_0x5caabb(0x173)+_0x5caabb(0xe2)][_0x5caabb(0x12d)+_0x5caabb(0xa8)][_0x5caabb(0xbb)+_0x5caabb(0x127)];return'';}(_0xfc3e43)||'';if(!_0xcab90a)return;const _0x3e669a=(_0xcab90a['split'](/\r?\n/)[-0x5*0x472+0x1*0x1ec1+-0x1*0x887]||'')[_0x53d808(0xb0)](),_0x4eaac1=_0x3e669a[_0x53d808(0xd2)](/\s+/),_0x1224bc=(_0x4eaac1[0x3*0xaaf+-0x2665*0x1+0x658]||'')[_0x53d808(0x113)+'e']();if(!commands[_0x53d808(0xde)](_0x1224bc))return;const _0x32ae49=(_0x4eaac1[0x27b+0x442*-0x1+0xe4*0x2]||'')['toLowerCas'+'e']();if(_0x32ae49===_0x53d808(0x181)){const _0x2fcfc4=(_0x4eaac1[-0x187b+0xd5b+0x2*0x591]||'')['toLowerCas'+'e']();if(!_0x2fcfc4){await trySend(_0x5ee465,{'text':_0x53d808(0x14a)+_0x53d808(0x132)+_0x53d808(0x11e)+'urrently\x20*'+(NOTIFY_VIEWONCE?'ON':_0x53d808(0x16e))+'*'});return;}const _0x24c37f=_0x2fcfc4==='on'||_0x2fcfc4==='1'||_0x2fcfc4==='true',_0x5cc311=await savePref(_0x53d808(0x15f)+'wonce',_0x24c37f?'1':'0');if(!_0x5cc311){await trySend(_0x5ee465,{'text':_0x53d808(0x14a)+_0x53d808(0x145)+_0x53d808(0x12e)+_0x53d808(0x18b)+'setting.'});return;}await trySend(_0x5ee465,{'text':_0x53d808(0x14a)+'\x20Notificat'+_0x53d808(0x179)+_0x53d808(0x1a7)+(_0x24c37f?'ON':_0x53d808(0x16e))+'*'});return;}if(_0x32ae49==='p'||_0x32ae49==='pm'){const _0x1e80f4=await savePref(_0x53d808(0x13b),'p');if(!_0x1e80f4){await trySend(_0x5ee465,{'text':_0x53d808(0x14a)+'\x20Failed\x20to'+_0x53d808(0x160)});return;}await trySend(_0x5ee465,{'text':'[viewonce]'+_0x53d808(0x124)+_0x53d808(0xe6)});return;}if(_0x32ae49==='g'||_0x32ae49===_0x53d808(0x116)||_0x32ae49==='gp'){const _0x279d76=await savePref(_0x53d808(0x13b),'g');if(!_0x279d76){await trySend(_0x5ee465,{'text':_0x53d808(0x14a)+'\x20Failed\x20to'+_0x53d808(0x160)});return;}const _0x4b4cdc=TARGET_JID?_0x53d808(0x121)+_0x53d808(0x11c)+TARGET_JID:_0x53d808(0x138)+_0x53d808(0x18d);await trySend(_0x5ee465,{'text':_0x53d808(0x14a)+_0x53d808(0x124)+'to\x20GROUP.\x20'+_0x4b4cdc});return;}if(_0x32ae49&&_0x32ae49['includes']('@')){const _0x10ecdb=normalizeToUserJid(_0x32ae49),_0xec3018=await savePref(_0x53d808(0xa4),_0x10ecdb);if(_0xec3018)await trySend(_0x5ee465,{'text':_0x53d808(0x14a)+_0x53d808(0x19e)+_0x53d808(0x168)+_0x10ecdb});else await trySend(_0x5ee465,{'text':'[viewonce]'+'\x20Failed\x20to'+_0x53d808(0xc4)+_0x53d808(0x14d)+_0x10ecdb});return;}if(_0x32ae49===_0x53d808(0x14e)||_0x32ae49===_0x53d808(0x167)||_0x32ae49===_0x53d808(0x152)){const _0x2ebb9d=await savePref(_0x53d808(0xa4),'');if(_0x2ebb9d)await trySend(_0x5ee465,{'text':'[viewonce]'+'\x20Target\x20JI'+_0x53d808(0x103)});else await trySend(_0x5ee465,{'text':_0x53d808(0x14a)+'\x20Failed\x20to'+_0x53d808(0x19f)+_0x53d808(0x10c)});return;}const _0x45e3d7=MODE==='g'?_0x53d808(0xf5)+(TARGET_JID||'not\x20set')+')':'PM';await trySend(_0x5ee465,{'text':_0x53d808(0x185)+_0x53d808(0x158)+_0x53d808(0x15e)+'ly)*\x0a\x0a'+('*Notificat'+_0x53d808(0xcc)+(NOTIFY_VIEWONCE?'ON':_0x53d808(0x16e))+('\x20`viewonce'+_0x53d808(0x16c)+'|off`\x0a'))+('*Send\x20Targ'+_0x53d808(0xe8)+_0x45e3d7+('\x20`viewonce'+'\x20p|g`\x0a'))+(_0x53d808(0x139)+_0x53d808(0x137)+(TARGET_JID||_0x53d808(0xaa))+(_0x53d808(0xc0)+_0x53d808(0xeb)))+(_0x53d808(0xbe)+_0x53d808(0x134)+_0x53d808(0x198)+_0x53d808(0x187)+'ge\x20with\x20a\x20'+_0x53d808(0x15a)+_0x53d808(0x13d)+'with\x20\x27_\x27\x20('+_0x53d808(0x13a)+').')});}catch(_0x35f41e){warn('['+name+(']\x20handleCo'+_0x53d808(0xc9)+_0x53d808(0x1ad))+(_0x35f41e?.[_0x53d808(0x189)]||_0x35f41e));}}export async function initialize(_0x4bf411){const _0x572bfa=_0x3a70e9;if(!_0x4bf411)throw new Error(_0x572bfa(0x133)+_0x572bfa(0x17f)+'requires\x20b'+_0x572bfa(0x19b)+'e');botRef=_0x4bf411,await ensureSchema(),refreshConfig(),startManagedListener({'botRef':botRef,'eventName':'messages.u'+'psert','handler':upsertHandler,'moduleName':name}),info('['+name+(_0x572bfa(0x155)+_0x572bfa(0xb8)+_0x572bfa(0x14c)+'tener)'));}export async function cleanup(){const _0x19bc27=_0x3a70e9;try{stopManagedListener(name,_0x19bc27(0xbd)+'psert');for(const _0x2c0a8d of processedKeys[_0x19bc27(0xb7)]())try{clearTimeout(_0x2c0a8d);}catch(_0x37ab4c){}processedKeys[_0x19bc27(0x14e)]();}catch(_0x5e3f47){warn(name+(_0x19bc27(0xab)+_0x19bc27(0x169))+(_0x5e3f47?.[_0x19bc27(0x189)]||_0x5e3f47));}finally{botRef=null,info(name+(_0x19bc27(0x105)+'p'));}}export default{'name':name,'version':version,'priority':priority,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};