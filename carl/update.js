const _0xe7726a=_0x2d0a;(function(_0x371a72,_0x1563e9){const _0x5fd81d=_0x2d0a,_0x3ec83f=_0x371a72();while(!![]){try{const _0x4617eb=-parseInt(_0x5fd81d(0x200))/(-0x1*-0x6e1+0x2595+-0x2c75)+parseInt(_0x5fd81d(0x20d))/(-0x760+0x916*-0x1+0x1078)*(-parseInt(_0x5fd81d(0x17c))/(-0x1*-0x527+-0x2465+0x1f41))+parseInt(_0x5fd81d(0xf4))/(-0xba1+0x12*0x171+0x1*-0xe4d)+-parseInt(_0x5fd81d(0x115))/(0x1*0x106b+0x238b+-0x33f1)+-parseInt(_0x5fd81d(0x118))/(-0x23c7+-0x2*-0x38d+0x1cb3)*(parseInt(_0x5fd81d(0x1b5))/(-0x1*0x66d+0x76b*0x4+-0x1738))+parseInt(_0x5fd81d(0x138))/(0x1499*-0x1+-0x20d6+0x3577)*(parseInt(_0x5fd81d(0xfb))/(0x355*-0x1+-0x56f+0x8cd))+parseInt(_0x5fd81d(0x154))/(0x4ab*-0x7+-0x18ea+0x1*0x39a1);if(_0x4617eb===_0x1563e9)break;else _0x3ec83f['push'](_0x3ec83f['shift']());}catch(_0x4e7aca){_0x3ec83f['push'](_0x3ec83f['shift']());}}}(_0xf0e5,0x1a*-0x52bb+0xa748f+0x6ea29));import _0x3ef44f from'fs/promises';import _0x12eb7b from'path';import{exec as _0x1351ed}from'child_process';import{promisify}from'util';import{fileURLToPath}from'url';import{DateTime}from'luxon';import{info,warn,error}from'../utils/logger.js';import{db}from'../utils/database.js';import{isSudo,listSudo,normalizeToJid,userJidFromCtx}from'../utils/sudo.js';import{getBotJid}from'../utils/bot-state.js';import{startManagedListener,stopManagedListener}from'../utils/listenerManager.js';const exec=promisify(_0x1351ed);export const name=_0xe7726a(0x109);export const version=_0xe7726a(0x1ad);export const priority=0x93f+-0x3*-0xa49+0x4*-0x9fa;export const commands=[_0xe7726a(0x109),'autoupdate'];let botRef=null,schedulerInterval=null,schedulerRunning=![];const API_URL='https://i-'+'tct.com/bu'+'ild',__filename=fileURLToPath(import.meta['url']),__dirname=_0x12eb7b[_0xe7726a(0xf7)](__filename),projectRoot=_0x12eb7b['resolve'](__dirname,'..'),snapshotPath=_0x12eb7b['join'](projectRoot,_0xe7726a(0x1ee),_0xe7726a(0x147),_0xe7726a(0x148)+'on'),removedPluginsPath=_0x12eb7b['join'](projectRoot,_0xe7726a(0x1ee),_0xe7726a(0x147),'.removed.j'+_0xe7726a(0x1b1));async function ensureSchema(){const _0x3f94b8=_0xe7726a;try{await db[_0x3f94b8(0x20b)](_0x3f94b8(0x174)+_0x3f94b8(0xf1)+_0x3f94b8(0x151)+'OT\x20EXISTS\x20'+_0x3f94b8(0x1e9)+_0x3f94b8(0x15b)+'\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+'\x20\x20\x20\x20settin'+_0x3f94b8(0x1ea)+'\x20PRIMARY\x20K'+_0x3f94b8(0x18e)+_0x3f94b8(0x1bb)+'enabled\x20IN'+_0x3f94b8(0x13d)+_0x3f94b8(0x198)+'\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x3f94b8(0x18a)+_0x3f94b8(0x190)+'NTEGER,\x0a\x20\x20'+_0x3f94b8(0x1bb)+'\x20\x20\x20\x20next_c'+_0x3f94b8(0x1e5)+'TEGER\x0a\x20\x20\x20\x20'+_0x3f94b8(0x1d2)+_0x3f94b8(0x156));const _0xd54380=await db['get'](_0x3f94b8(0x14d)+_0x3f94b8(0xf3)+'_settings\x20'+_0x3f94b8(0x1ed)+_0x3f94b8(0x20a)+_0x3f94b8(0x1c1)+'e\x27');!_0xd54380&&await db[_0x3f94b8(0x178)](_0x3f94b8(0x162)+'O\x20update_s'+_0x3f94b8(0x18d)+'etting_key'+_0x3f94b8(0x11f)+_0x3f94b8(0x1c1)+_0x3f94b8(0x1c9)),info('['+name+(_0x3f94b8(0x19d)+'a\x20ensured.'));}catch(_0x10e9b8){error(_0x10e9b8,'['+name+(_0x3f94b8(0x19d)+'a\x20initiali'+'zation\x20fai'+'led'));throw _0x10e9b8;}}async function getAutoUpdateSettings(){const _0x5b272e=_0xe7726a;try{const _0x1fd8ea=await db['get']('SELECT\x20*\x20F'+'ROM\x20update'+_0x5b272e(0x1f4)+_0x5b272e(0x1ed)+_0x5b272e(0x20a)+_0x5b272e(0x1c1)+'e\x27');return{'enabled':!!_0x1fd8ea?.['enabled'],'lastCheckedAt':_0x1fd8ea?.[_0x5b272e(0x183)+'ed_at']||null,'nextCheckAt':_0x1fd8ea?.[_0x5b272e(0x139)+_0x5b272e(0x199)]||null};}catch(_0x293593){return error(_0x293593,'['+name+(_0x5b272e(0x19e)+_0x5b272e(0x196)+_0x5b272e(0x153)+'tings')),{'enabled':![],'lastCheckedAt':null,'nextCheckAt':null};}}async function setAutoUpdateStatus(_0x35d6ae){const _0x135a23=_0xe7726a;try{const _0x2d5075=_0x35d6ae?DateTime['now']()[_0x135a23(0x11d)]({'hours':0x18})['toSeconds']():null;await db[_0x135a23(0x178)](_0x135a23(0x203)+_0x135a23(0x1d1)+_0x135a23(0x208)+_0x135a23(0x1a8)+_0x135a23(0x139)+_0x135a23(0x12c)+'ERE\x20settin'+'g_key\x20=\x20\x27a'+_0x135a23(0x159),[_0x35d6ae?-0x6c1+-0x1c4f*0x1+0x2311:-0x5fd*0x3+0x1f1*-0xd+0x2b34,_0x2d5075]);if(_0x35d6ae)await updateCheckTimestamps();return!![];}catch(_0x10e8ac){return error(_0x10e8ac,'['+name+(_0x135a23(0x19e)+_0x135a23(0x12d)+'update\x20sta'+'tus')),![];}}async function updateCheckTimestamps(){const _0x4dd354=_0xe7726a;try{const _0x429c4b=Math[_0x4dd354(0x112)](Date[_0x4dd354(0x15f)]()/(-0x201f+-0x5*0x28d+0x7*0x6f8)),_0x1660d8=DateTime['now']()[_0x4dd354(0x11d)]({'hours':0x18})[_0x4dd354(0x116)]();await db[_0x4dd354(0x178)](_0x4dd354(0x203)+_0x4dd354(0x1d1)+'gs\x20SET\x20las'+_0x4dd354(0x1d4)+_0x4dd354(0x1fa)+_0x4dd354(0x192)+_0x4dd354(0x11e)+_0x4dd354(0x1d9)+_0x4dd354(0x20e)+_0x4dd354(0x14b),[_0x429c4b,Math[_0x4dd354(0x112)](_0x1660d8)]);}catch(_0x490fd9){error(_0x490fd9,'['+name+(']\x20Failed\x20t'+_0x4dd354(0x160)+_0x4dd354(0x1cd)+_0x4dd354(0x165)));}}async function safeSend(_0x39532c,_0x36bf51){const _0x1c673c=_0xe7726a;if(!_0x39532c){warn('['+name+(_0x1c673c(0x1cb)+_0x1c673c(0x135)+_0x1c673c(0x124)+_0x1c673c(0x141)));return;}try{const _0x33faa9=botRef[_0x1c673c(0x1a6)+'e']||botRef[_0x1c673c(0x1e4)]?.[_0x1c673c(0x1a6)+'e'];if(_0x33faa9)await _0x33faa9(_0x39532c,{'text':_0x36bf51});else warn('['+name+(_0x1c673c(0x18c)+_0x1c673c(0xfd)+_0x1c673c(0x1f9)));}catch(_0x4b6c66){error(_0x4b6c66,'['+name+(_0x1c673c(0x19e)+'o\x20send\x20mes'+_0x1c673c(0x155))+_0x39532c);}}function _0xf0e5(){const _0x2cbe79=['string',']\x20onMessag','floor','\x20unchanged','n\x20identica','2806305qTYaBJ','toSeconds','g\x20\x27yarn\x20in','132450YZItZG','anges.','date.','d\x20core\x20upd','map','plus','t\x20=\x20?\x20WHER',')\x20VALUES\x20(','\x20Applying.','ðŸ”„\x20Your\x20bot','nitial\x20sna','g:\x0a','th\x20no\x20dest','wnloads\x20ma','DISABLED.','files','ler\x20starte','ng\x20is\x20alre','close','status','_at\x20=\x20?\x20WH','o\x20set\x20auto','ðŸ”„\x20Update\x20f','\x0a\x0aStatus:\x20','kipped\x20upd','on|off','ed\x20updatin','able.\x20Run\x20','toLowerCas','\x20called\x20wi','es...','findings','1384MpMqOX','next_check','nts.','\x20new\x20files','d\x20plugin\x20u','TEGER\x20DEFA','`update\x20no','key','o\x20download','ination.','ates.\x20Noti','auto-updat','e\x20applying','tes\x20were\x20a','DISABLED','tmp','.update.js','oot`\x20comma','plugin\x20fil','oupdate\x27','jid','SELECT\x20*\x20F','y\x20have\x20bee','utoupdate\x20','origin','TABLE\x20IF\x20N','clusions.','update\x20set','27185820gWnABh','sage\x20to\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','connection','te\x20Status*','utoupdate\x27','on\x20first\x20r','tings\x20(\x0a\x20\x20','core\x20compo','r\x20tick\x20fai','y\x20up\x20to\x20da','now','o\x20update\x20c','dated.','INSERT\x20INT','off','download','tamps','*Auto-Upda','catch','snapshot\x20c',']\x20Missing\x20',';\x20skipping','ðŸ”„\x20Automati','led','pdates:\x20','te.','\x0a\x0aPlease\x20r','ours.','oved\x20plugi','lastModifi','package.js','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20','stall\x27...','\x20core\x20chan','\x0aPlease\x20ru','run','writeFile','isArray','ate:\x20apply','597585ppObWE','found.\x20Cre','boot`\x20comm','ting.','ate:\x20nothi','ate\x20applie','yarn\x20insta','last_check','plugins:\x0a','\x20â€”\x20content','stall\x27\x20fai','r\x20updates.','ck:\x20','text','\x20\x20\x20last_ch','API\x20reques',']\x20No\x20send\x20','ettings\x20(s','EY,\x0a\x20\x20\x20\x20\x20\x20','scheduled\x20','ecked_at\x20I','ocess...','xt_check_a','has','o\x20fetch\x20bu','r\x20updates\x20','o\x20get\x20auto','e\x20effect.','ULT\x200,\x0a\x20\x20\x20','_at','plugins:\x20M','filter','endsWith',']\x20DB\x20schem',']\x20Failed\x20t','ns\x20file;\x20p','remoteJid','Updated\x20pl',']\x20Schedule','n\x20the\x20`reb','or\x20',']\x20Auto-upd','sendMessag','object','bled\x20=\x20?,\x20','@g.us','lugin(s).','ating:\x0a','d\x20successf','2.1.5','accurate.','un\x20the\x20`re','ltering\x20','son','ENABLED.\x20T','json','date\x20for\x20','322GPIRaT',']\x20Could\x20no','zed.','trim','nextCheckA','ðŸ”„\x20Updated\x20','\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','ugins:\x20Mor','\x20Please\x20tr','ly.\x0a\x0aSkipp','have\x20been\x20','readFile','\x27autoupdat','\x20is\x20alread',']\x20Initial\x20','carl','mtime',']\x20Skipped\x20','w`\x20to\x20appl','led.','e\x27)','c\x20Update\x20N',']\x20safeSend','\x20removed).','heck\x20times','up.','ore\x20than\x201','ðŸ”„\x20No\x20appli','ate_settin','\x20\x20\x20\x20\x20\x20\x20\x20);','ly\x20core\x20ch','t_checked_','reated\x20suc','ating\x20one\x20','updated.','without\x20ex','E\x20setting_','y\x20again\x20la','cessfully.','ng\x20','cies\x20insta',']\x20\x27yarn\x20in','parse','.update','\x20->\x20','ðŸ”„\x20Everythi','ðŸ”„\x20An\x20updat','sock','heck_at\x20IN','nents.','mkdir','readyState','update_set','g_key\x20TEXT','result.','al\x20snapsho','WHERE\x20sett','data','cable\x20upda','pplied.\x0a\x0aS','utf-8','c\x20updates\x20',']\x20cleaned\x20','_settings\x20','name',']\x20No\x20local',']\x20Error\x20wh','ðŸ”„\x20Starting','ble.','at\x20=\x20?,\x20ne','ate\x20found\x20','ng\x20to\x20appl','enabled','Updated\x20co','e\x20than\x2010\x20','662258rJzKKu','e\x20error','and\x20to\x20app','UPDATE\x20upd','les\x20were\x20w','\x20for\x20updat','l\x20check\x20fo','replace','gs\x20SET\x20ena','e\x20check...','ing_key\x20=\x20','exec','join','2lRjAgi','key\x20=\x20\x27aut','\x20update\x20pr','push',']\x20Dependen','\x20\x20\x20CREATE\x20','toRelative','ROM\x20update','335780lUTYte','ompleted.','length','dirname','\x20removed\x20p','y\x20after\x20fi','Updates\x20re','11619IgmNLc','fying\x20owne','API\x20availa','fromMe','includes','\x20(skipped\x20','get',']\x20Running\x20','fromSecond',']\x20package.','start.cjs','ady\x20up\x20to\x20','ate\x20schedu','modules','update','l).\x20Skippe','un...','t\x20failed:\x20','json\x20chang','split','ges\x20to\x20tak'];_0xf0e5=function(){return _0x2cbe79;};return _0xf0e5();}async function fetchBuildInfo(){const _0x41c1bc=_0xe7726a;try{const _0x43e1f4=await fetch(API_URL);if(!_0x43e1f4['ok'])throw new Error(_0x41c1bc(0x18b)+_0x41c1bc(0x10c)+_0x43e1f4[_0x41c1bc(0x12b)]);return await _0x43e1f4[_0x41c1bc(0x1b3)]();}catch(_0x4b74f6){return error(_0x4b74f6,'['+name+(_0x41c1bc(0x19e)+_0x41c1bc(0x194)+'ild\x20info')),null;}}async function getLocalSnapshot(){const _0x185667=_0xe7726a;try{const _0x201ab6=await _0x3ef44f['readFile'](snapshotPath,_0x185667(0x1f1));return JSON['parse'](_0x201ab6);}catch(_0x23241d){return null;}}async function saveLocalSnapshot(_0x21c266){const _0x1e5bd4=_0xe7726a;try{await _0x3ef44f['mkdir'](_0x12eb7b[_0x1e5bd4(0xf7)](snapshotPath),{'recursive':!![]}),await _0x3ef44f[_0x1e5bd4(0x179)](snapshotPath,JSON['stringify'](_0x21c266,null,0x2392+0xa70*-0x1+-0x1920));}catch(_0x5546e7){error(_0x5546e7,'['+name+(']\x20Failed\x20t'+'o\x20save\x20loc'+_0x1e5bd4(0x1ec)+'t'));}}async function createInitialSnapshotIfNeeded(){const _0x88f21b=_0xe7726a,_0x3ff156=await getLocalSnapshot();if(!_0x3ff156){info('['+name+(_0x88f21b(0x1f6)+'\x20snapshot\x20'+_0x88f21b(0x17d)+_0x88f21b(0x1d6)+_0x88f21b(0x15a)+_0x88f21b(0x10b)));const _0x36e660=await fetchBuildInfo();_0x36e660?(await saveLocalSnapshot(_0x36e660),info('['+name+(_0x88f21b(0x1c3)+_0x88f21b(0x168)+_0x88f21b(0x1d5)+_0x88f21b(0x1db)))):warn('['+name+(_0x88f21b(0x1b6)+'t\x20create\x20i'+_0x88f21b(0x122)+'pshot.\x20Upd'+'ate\x20checks'+'\x20may\x20be\x20in'+_0x88f21b(0x1ae)));}}function getDestinationPath(_0x355bd8){const _0x195ca2=_0xe7726a,_0x2b5954=['bot.js',_0x195ca2(0x105),_0x195ca2(0x173)+'on','qrcode.js'];if(_0x355bd8[_0x195ca2(0x150)]==='carl')return _0x12eb7b[_0x195ca2(0x20c)](projectRoot,_0x195ca2(0x1c4),_0x355bd8[_0x195ca2(0x1f5)]);if(_0x355bd8[_0x195ca2(0x150)]==='modules')return _0x12eb7b[_0x195ca2(0x20c)](projectRoot,_0x195ca2(0x108),_0x355bd8['name']);if(_0x2b5954[_0x195ca2(0xff)](_0x355bd8[_0x195ca2(0x1f5)]))return _0x12eb7b[_0x195ca2(0x20c)](projectRoot,_0x355bd8[_0x195ca2(0x1f5)]);return _0x12eb7b[_0x195ca2(0x20c)](projectRoot,'utils',_0x355bd8[_0x195ca2(0x1f5)]);}async function applyUpdates(_0x2d7218){const _0x3e5693=_0xe7726a;let _0x6f6069=![];const _0x5d2b57=[],_0x4f452b=[];for(const _0x5ca795 of _0x2d7218){if(!_0x5ca795||!_0x5ca795['download']){warn('['+name+(_0x3e5693(0x169)+'download\x20f'+_0x3e5693(0x1a4))+(_0x5ca795?.['name']??'<unknown>')+(_0x3e5693(0x16a)+'.'));continue;}const _0x27c500=getDestinationPath(_0x5ca795);try{const _0x57481d=await fetch(_0x5ca795[_0x3e5693(0x164)]);if(!_0x57481d['ok']){warn('['+name+(_0x3e5693(0x19e)+_0x3e5693(0x140)+'\x20')+_0x5ca795[_0x3e5693(0x1f5)]+':\x20'+_0x57481d[_0x3e5693(0x12b)]);continue;}const _0x2d3a79=await _0x57481d[_0x3e5693(0x189)]();let _0xac4e5e=null;try{_0xac4e5e=await _0x3ef44f[_0x3e5693(0x1c0)](_0x27c500,_0x3e5693(0x1f1));}catch(_0x48bbd4){_0xac4e5e=null;}if(_0xac4e5e!==null&&_0xac4e5e===_0x2d3a79){info('['+name+(_0x3e5693(0x1c6)+'writing\x20')+_0x5ca795['name']+(_0x3e5693(0x185)+_0x3e5693(0x113)+'.'));continue;}await _0x3ef44f[_0x3e5693(0x1e7)](_0x12eb7b[_0x3e5693(0xf7)](_0x27c500),{'recursive':!![]}),await _0x3ef44f[_0x3e5693(0x179)](_0x27c500,_0x2d3a79,_0x3e5693(0x1f1)),_0x5ca795[_0x3e5693(0x150)]===_0x3e5693(0x1c4)||_0x5ca795[_0x3e5693(0x150)]==='modules'?_0x5d2b57['push'](String(_0x5ca795[_0x3e5693(0x1f5)])[_0x3e5693(0x207)](/\.js$/,'')):_0x4f452b[_0x3e5693(0xef)](_0x5ca795[_0x3e5693(0x1f5)]),info('['+name+(']\x20Wrote\x20up'+_0x3e5693(0x1b4))+_0x5ca795[_0x3e5693(0x1f5)]+_0x3e5693(0x1e1)+_0x27c500);}catch(_0x5be498){warn(_0x5be498,'['+name+(_0x3e5693(0x1f7)+'ile\x20updati'+_0x3e5693(0x1dc))+_0x5ca795[_0x3e5693(0x1f5)]);}}const _0x1f9386=_0x4f452b[_0x3e5693(0xff)]('package.js'+'on');if(_0x1f9386)try{info('['+name+(_0x3e5693(0x104)+_0x3e5693(0x10d)+'ed.\x20Runnin'+_0x3e5693(0x117)+_0x3e5693(0x175))),await exec(_0x3e5693(0x182)+'ll',{'cwd':projectRoot}),info('['+name+(_0x3e5693(0xf0)+_0x3e5693(0x1dd)+'lled\x20succe'+'ssfully.'));}catch(_0x13dd18){error(_0x13dd18,'['+name+(_0x3e5693(0x1de)+_0x3e5693(0x186)+_0x3e5693(0x1c8)));}if(_0x4f452b['length']>0xc66+-0xc01+-0x65)_0x6f6069=!![];return{'updatedPluginFiles':_0x5d2b57,'updatedCoreFiles':_0x4f452b,'needsReboot':_0x6f6069};}async function getRemovedPluginsSet(){const _0x51f33f=_0xe7726a;try{const _0x1bd14a=await _0x3ef44f[_0x51f33f(0x1c0)](removedPluginsPath,_0x51f33f(0x1f1))[_0x51f33f(0x167)](()=>null);if(!_0x1bd14a)return new Set();const _0x211417=JSON[_0x51f33f(0x1df)](_0x1bd14a);if(!Array[_0x51f33f(0x17a)](_0x211417))return new Set();const _0x15cd20=_0x211417[_0x51f33f(0x11c)](_0x3cee69=>{const _0x5eb45b=_0x51f33f;if(!_0x3cee69)return null;if(typeof _0x3cee69===_0x5eb45b(0x110))return _0x3cee69;if(typeof _0x3cee69===_0x5eb45b(0x1a7)&&_0x3cee69[_0x5eb45b(0x1f5)])return _0x3cee69[_0x5eb45b(0x1f5)];return null;})['filter'](Boolean)[_0x51f33f(0x11c)](_0xab25bf=>String(_0xab25bf)[_0x51f33f(0x134)+'e']()[_0x51f33f(0x207)](/\.js$/,''));return new Set(_0x15cd20);}catch(_0xd7d1d3){return warn(_0xd7d1d3,'['+name+(_0x51f33f(0x1b6)+'t\x20read\x20rem'+_0x51f33f(0x171)+_0x51f33f(0x19f)+'roceeding\x20'+_0x51f33f(0x1d8)+_0x51f33f(0x152))),new Set();}}function _0x2d0a(_0x438b2e,_0x4e4925){const _0x308c84=_0xf0e5();return _0x2d0a=function(_0x40adab,_0x3af8ff){_0x40adab=_0x40adab-(0xdc+0x11b4+0x25*-0x7a);let _0x55589b=_0x308c84[_0x40adab];return _0x55589b;},_0x2d0a(_0x438b2e,_0x4e4925);}async function _schedulerTick(){const _0x55b9f9=_0xe7726a;if(schedulerRunning)return;schedulerRunning=!![];try{const _0x377ee9=await getAutoUpdateSettings();if(!_0x377ee9[_0x55b9f9(0x1fd)])return;const _0x48cf74=DateTime['now'](),_0x2c61fb=_0x377ee9[_0x55b9f9(0x1b9)+'t']?DateTime[_0x55b9f9(0x103)+'s'](_0x377ee9[_0x55b9f9(0x1b9)+'t']):_0x48cf74;_0x48cf74>=_0x2c61fb&&(info('['+name+(_0x55b9f9(0x102)+_0x55b9f9(0x18f)+_0x55b9f9(0x143)+_0x55b9f9(0x209))),await performAutomaticUpdate(),await updateCheckTimestamps());}catch(_0x1c06db){error(_0x1c06db,'['+name+(_0x55b9f9(0x1a2)+_0x55b9f9(0x15d)+_0x55b9f9(0x16c)));}finally{schedulerRunning=![];}}function startAutoUpdateScheduler(){const _0x3e8a74=_0xe7726a;stopAutoUpdateScheduler();const _0x217dae=-0x1bd9e+-0x45*0x41b+0x3c345-Date[_0x3e8a74(0x15f)]()%(-0xc089+0x5f8+0x1a4f1);setTimeout(()=>{const _0x27dc5e=_0x3e8a74;_schedulerTick()['catch'](()=>{}),schedulerInterval=setInterval(()=>_schedulerTick()[_0x27dc5e(0x167)](()=>{}),(-0x16*0xb2+0xd0*0x4+0x418*0x3)*(0x23f1+0x22c1+-0x2*0x2165));},_0x217dae),info('['+name+(_0x3e8a74(0x1a5)+_0x3e8a74(0x107)+_0x3e8a74(0x128)+'d.'));}function stopAutoUpdateScheduler(){schedulerInterval&&(clearInterval(schedulerInterval),schedulerInterval=null);}async function findStoredMatchFromFindings(_0x3a3256=[]){const _0x29791b=_0xe7726a;try{const _0x3c4c8a=await listSudo();if(!Array[_0x29791b(0x17a)](_0x3c4c8a)||_0x3c4c8a[_0x29791b(0xf6)]===0xeb4*0x2+-0x243c+-0x26*-0x2e)return null;const _0x187e6b=new Set(_0x3c4c8a['map'](String));for(const _0x2dad86 of _0x3a3256||[]){if(!_0x2dad86||typeof _0x2dad86['jid']!==_0x29791b(0x110))continue;const _0x347c30=normalizeToJid(_0x2dad86[_0x29791b(0x14c)]);if(_0x347c30&&_0x187e6b['has'](_0x347c30))return _0x347c30;if(_0x187e6b['has'](_0x2dad86[_0x29791b(0x14c)]))return _0x2dad86[_0x29791b(0x14c)];}return null;}catch(_0x2ad6d3){return null;}}async function handleManualUpdateCheck(_0x3e19f2){const _0x4e7fc5=_0xe7726a;await safeSend(_0x3e19f2,'ðŸ”„\x20Checking'+_0x4e7fc5(0x205)+_0x4e7fc5(0x136));const _0x14984e=await fetchBuildInfo();if(!_0x14984e){await safeSend(_0x3e19f2,'ðŸ”„\x20Could\x20no'+'t\x20check\x20fo'+_0x4e7fc5(0x187)+_0x4e7fc5(0x1bd)+_0x4e7fc5(0x1da)+'ter.');return;}const _0x35d3d1=await getLocalSnapshot();!_0x35d3d1||_0x14984e[_0x4e7fc5(0x172)+'ed']!==_0x35d3d1['lastModifi'+'ed']?await safeSend(_0x3e19f2,_0x4e7fc5(0x1e3)+'e\x20is\x20avail'+_0x4e7fc5(0x133)+_0x4e7fc5(0x13e)+_0x4e7fc5(0x1c7)+'y.'):await safeSend(_0x3e19f2,_0x4e7fc5(0x121)+_0x4e7fc5(0x1c2)+_0x4e7fc5(0x15e)+_0x4e7fc5(0x16e));}async function handleManualUpdateNow(_0x2203e2){const _0x962e4c=_0xe7726a;await safeSend(_0x2203e2,_0x962e4c(0x1f8)+_0x962e4c(0xee)+_0x962e4c(0x191));const _0xf11c94=await fetchBuildInfo(),_0x16bb10=await getLocalSnapshot();if(!_0xf11c94||!_0x16bb10){await safeSend(_0x2203e2,'ðŸ”„\x20Could\x20no'+'t\x20get\x20upda'+'te\x20informa'+'tion.\x20Abor'+_0x962e4c(0x17f));return;}const _0x903e4c=await getRemovedPluginsSet(),_0x3af44e=new Map(_0x16bb10[_0x962e4c(0x127)][_0x962e4c(0x11c)](_0x3e659d=>[_0x3e659d[_0x962e4c(0x1f5)],_0x3e659d])),_0x4887c1=_0xf11c94[_0x962e4c(0x127)][_0x962e4c(0x19b)](_0x2e0ecc=>_0x3af44e['get'](_0x2e0ecc['name'])?.[_0x962e4c(0x1c5)]!==_0x2e0ecc[_0x962e4c(0x1c5)]),_0x2a78cb=[],_0x4ede0c=[];for(const _0x11cf6c of _0x4887c1){if(!_0x11cf6c||!_0x11cf6c['origin']){_0x4ede0c['push'](_0x11cf6c);continue;}if([_0x962e4c(0x1c4),'modules'][_0x962e4c(0xff)](_0x11cf6c[_0x962e4c(0x150)])){const _0x50a957=String(_0x11cf6c[_0x962e4c(0x1f5)])[_0x962e4c(0x134)+'e']()[_0x962e4c(0x207)](/\.js$/,'');if(_0x903e4c['has'](_0x50a957)){_0x2a78cb[_0x962e4c(0xef)](_0x50a957);continue;}}_0x4ede0c[_0x962e4c(0xef)](_0x11cf6c);}if(_0x4ede0c[_0x962e4c(0xf6)]===-0x1ca5+0xeb*0x1f+0x6*0x8){await saveLocalSnapshot(_0xf11c94);if(_0x2a78cb[_0x962e4c(0xf6)]>0x715*0x1+-0x7a*0x1+-0x69b*0x1){const _0x196a8f=_0x2a78cb['map']((_0x3845bf,_0x486b61)=>_0x486b61+(-0x1*-0x2054+-0x20de+-0x1*-0x8b)+'.\x20'+_0x3845bf)[_0x962e4c(0x20c)]('\x0a');await safeSend(_0x2203e2,_0x962e4c(0x1d0)+_0x962e4c(0x1ef)+'tes\x20to\x20app'+_0x962e4c(0x1be)+_0x962e4c(0x132)+_0x962e4c(0x123)+_0x196a8f);}else await safeSend(_0x2203e2,_0x962e4c(0x1e2)+'ng\x20is\x20alre'+_0x962e4c(0x106)+_0x962e4c(0x11a));return;}const _0xf8e0c5=await applyUpdates(_0x4ede0c);if(!_0xf8e0c5){await safeSend(_0x2203e2,_0x962e4c(0x12e)+'ailed\x20whil'+_0x962e4c(0x144)+'\x20updates.');return;}const {updatedPluginFiles:_0x9f9d3b,updatedCoreFiles:_0x10ee77,needsReboot:_0x367b2d}=_0xf8e0c5;if(_0x9f9d3b[_0x962e4c(0xf6)]===-0x15cf+0xbc*-0x2b+0x3563&&_0x10ee77[_0x962e4c(0xf6)]===-0x1f70+0x1ed0+0xa0){await saveLocalSnapshot(_0xf11c94);if(_0x2a78cb[_0x962e4c(0xf6)]>0x1301+0x3*0xc14+-0x373d){const _0x5af1e0=_0x2a78cb[_0x962e4c(0x11c)]((_0x2bf5b6,_0x57bb82)=>_0x57bb82+(0x1bbb+0x38f+0x1f49*-0x1)+'.\x20'+_0x2bf5b6)[_0x962e4c(0x20c)]('\x0a');await safeSend(_0x2203e2,'ðŸ”„\x20No\x20appli'+_0x962e4c(0x1ef)+_0x962e4c(0x145)+_0x962e4c(0x1f0)+_0x962e4c(0x130)+_0x962e4c(0x1ab)+_0x5af1e0);}else await safeSend(_0x2203e2,'ðŸ”„\x20Everythi'+_0x962e4c(0x129)+_0x962e4c(0x106)+'date.');return;}const _0x2563f1=[];if(_0x9f9d3b[_0x962e4c(0xf6)]>0x173+0x2066+-0x21d9){if(_0x9f9d3b[_0x962e4c(0xf6)]<=0x8af+0x26ee+0x13*-0x281){const _0x57f2cf=_0x9f9d3b['map']((_0x472da2,_0x1b0b25)=>_0x1b0b25+(0x1c*-0xb3+0x769+-0x26*-0x52)+'.\x20'+_0x472da2)['join']('\x0a');_0x2563f1[_0x962e4c(0xef)]('ðŸ”„\x20Updated\x20'+_0x962e4c(0x184)+_0x57f2cf);}else _0x2563f1[_0x962e4c(0xef)]('ðŸ”„\x20Updated\x20'+_0x962e4c(0x19a)+_0x962e4c(0x1cf)+'0\x20plugin\x20f'+'iles\x20were\x20'+_0x962e4c(0x1d7));}_0x10ee77[_0x962e4c(0xf6)]>0xb5d+0x3*0x862+-0x2cf*0xd&&_0x2563f1[_0x962e4c(0xef)](_0x962e4c(0x1ba)+_0x962e4c(0x15c)+_0x962e4c(0x1e6));if(_0x2563f1[_0x962e4c(0xf6)]===0x1462+-0x140+0x991*-0x2)_0x2563f1[_0x962e4c(0xef)]('ðŸ”„\x20Update\x20c'+_0x962e4c(0xf5));(_0x10ee77[_0x962e4c(0xf6)]>-0x590+0x1*0x1e01+0x1*-0x1871||_0x367b2d)&&_0x2563f1[_0x962e4c(0xef)](_0x962e4c(0x177)+_0x962e4c(0x1a3)+_0x962e4c(0x149)+'nd\x20for\x20the'+_0x962e4c(0x176)+_0x962e4c(0x10f)+_0x962e4c(0x197));const _0x74c913=_0x2563f1[_0x962e4c(0x20c)]('\x0a\x0a');await safeSend(_0x2203e2,_0x74c913),await saveLocalSnapshot(_0xf11c94);}async function performAutomaticUpdate(){const _0x8e89c3=_0xe7726a,_0x81341d=await fetchBuildInfo(),_0x2b0bf6=await getLocalSnapshot();if(!_0x81341d||!_0x2b0bf6||_0x81341d['lastModifi'+'ed']===_0x2b0bf6[_0x8e89c3(0x172)+'ed'])return;const _0x250295=await getRemovedPluginsSet(),_0x211510=new Map(_0x2b0bf6['files'][_0x8e89c3(0x11c)](_0x3ad5c4=>[_0x3ad5c4[_0x8e89c3(0x1f5)],_0x3ad5c4])),_0x1f0e2a=_0x81341d[_0x8e89c3(0x127)][_0x8e89c3(0x19b)](_0x248489=>_0x211510[_0x8e89c3(0x101)](_0x248489[_0x8e89c3(0x1f5)])?.[_0x8e89c3(0x1c5)]!==_0x248489[_0x8e89c3(0x1c5)]);if(_0x1f0e2a[_0x8e89c3(0xf6)]===0x3*-0x601+-0x518*-0x1+0xceb){await saveLocalSnapshot(_0x81341d);return;}const _0x377a4e=[],_0x277743=[];for(const _0x2a3d07 of _0x1f0e2a){if(!_0x2a3d07||!_0x2a3d07[_0x8e89c3(0x150)]){_0x277743[_0x8e89c3(0xef)](_0x2a3d07);continue;}if(['carl',_0x8e89c3(0x108)][_0x8e89c3(0xff)](_0x2a3d07['origin'])){const _0x165131=String(_0x2a3d07[_0x8e89c3(0x1f5)]||'')['toLowerCas'+'e']()[_0x8e89c3(0x207)](/\.js$/,'');if(_0x250295[_0x8e89c3(0x193)](_0x165131)){_0x377a4e['push'](_0x165131);continue;}}_0x277743[_0x8e89c3(0xef)](_0x2a3d07);}if(_0x277743[_0x8e89c3(0xf6)]===0x13e5+-0x210a*0x1+0xd25){info('['+name+(']\x20Auto-upd'+_0x8e89c3(0x180)+_0x8e89c3(0x1fc)+_0x8e89c3(0xf9)+_0x8e89c3(0x1b0))+_0x377a4e[_0x8e89c3(0xf6)]+('\x20removed\x20p'+_0x8e89c3(0x1aa))),await saveLocalSnapshot(_0x81341d);return;}info('['+name+(_0x8e89c3(0x1a5)+_0x8e89c3(0x1fb))+_0x277743['length']+(_0x8e89c3(0x13b)+_0x8e89c3(0x100))+_0x377a4e[_0x8e89c3(0xf6)]+(_0x8e89c3(0x1cc)+_0x8e89c3(0x120)+'..'));const _0x5aa3d8=await applyUpdates(_0x277743);if(!_0x5aa3d8){warn('['+name+(_0x8e89c3(0x1a5)+_0x8e89c3(0x17b)+_0x8e89c3(0xfa)+'turned\x20no\x20'+_0x8e89c3(0x1eb))),await saveLocalSnapshot(_0x81341d);return;}const {updatedPluginFiles:_0x4ae3d9,updatedCoreFiles:_0x2a3867,needsReboot:_0x3e7359}=_0x5aa3d8;if(_0x4ae3d9[_0x8e89c3(0xf6)]===-0x1*0x1279+0x2d*-0x1d+0x1*0x1792&&_0x2a3867[_0x8e89c3(0xf6)]===-0x1e6c+-0x8a9+-0x1d*-0x159){info('['+name+(']\x20Auto-upd'+'ate:\x20no\x20fi'+_0x8e89c3(0x204)+'ritten\x20(do'+_0x8e89c3(0x125)+_0x8e89c3(0x14e)+_0x8e89c3(0x114)+_0x8e89c3(0x10a)+'d\x20')+_0x377a4e[_0x8e89c3(0xf6)]+(_0x8e89c3(0xf8)+_0x8e89c3(0x1aa))),await saveLocalSnapshot(_0x81341d);return;}if(_0x2a3867[_0x8e89c3(0xf6)]>-0x4a*-0x1+0x12bf+-0x1*0x1309){info('['+name+(_0x8e89c3(0x1a5)+_0x8e89c3(0x181)+_0x8e89c3(0x11b)+_0x8e89c3(0x142)+_0x8e89c3(0xfc)+'r.'));const _0x4b5a17=getBotJid();if(_0x4b5a17){const _0x4a851f=[];_0x4ae3d9[_0x8e89c3(0xf6)]>-0x1*-0xd4+-0xb3b*-0x3+-0x2285&&(_0x4ae3d9[_0x8e89c3(0xf6)]<=0x1f25+0x942+-0x285d?_0x4a851f[_0x8e89c3(0xef)]('Updated\x20pl'+'ugins:\x0a'+_0x4ae3d9[_0x8e89c3(0x11c)]((_0x500cf1,_0x6b209e)=>_0x6b209e+(-0x70c+0x1*0x2603+0x6*-0x529)+'.\x20'+_0x500cf1)['join']('\x0a')):_0x4a851f['push'](_0x8e89c3(0x1a1)+_0x8e89c3(0x1bc)+_0x8e89c3(0x1ff)+_0x8e89c3(0x14a)+'es\x20were\x20up'+_0x8e89c3(0x161))),_0x4a851f[_0x8e89c3(0xef)](_0x8e89c3(0x1fe)+'re\x20compone'+_0x8e89c3(0x13a)),await safeSend(_0x4b5a17,'â„¹ï¸\x20Automati'+_0x8e89c3(0x1ca)+'otice:\x0a\x0a'+_0x4a851f[_0x8e89c3(0x20c)]('\x0a\x0a')+(_0x8e89c3(0x16f)+_0x8e89c3(0x1af)+_0x8e89c3(0x17e)+_0x8e89c3(0x202)+_0x8e89c3(0x1d3)+_0x8e89c3(0x119)));}}else info('['+name+(_0x8e89c3(0x1a5)+'ate\x20applie'+_0x8e89c3(0x13c)+_0x8e89c3(0x16d))+_0x4ae3d9[_0x8e89c3(0xf6)]+'\x20item(s).');await saveLocalSnapshot(_0x81341d),info('['+name+(_0x8e89c3(0x1a5)+'ate\x20applie'+_0x8e89c3(0x1ac)+'ully.'));}export async function initialize(_0x33c15d){const _0x4c9f2f=_0xe7726a;botRef=_0x33c15d,await ensureSchema(),await createInitialSnapshotIfNeeded(),startManagedListener({'botRef':botRef,'eventName':_0x4c9f2f(0x157)+_0x4c9f2f(0x1e0),'moduleName':name,'handler':_0x1f6e3f=>{const _0x52e984=_0x4c9f2f;if(_0x1f6e3f['connection']==='open')startAutoUpdateScheduler();else{if(_0x1f6e3f['connection']===_0x52e984(0x12a))stopAutoUpdateScheduler();}}}),(botRef['ws']?.[_0x4c9f2f(0x1e8)]===-0x37*0x18+0x14b4+-0xf8b||botRef[_0x4c9f2f(0x1e4)]?.['ws']?.[_0x4c9f2f(0x1e8)]===-0x1ef0+-0x1e*-0xe3+0x1*0x457)&&startAutoUpdateScheduler(),info('['+name+(']\x20initiali'+_0x4c9f2f(0x1b7)));}export async function onMessage(_0x514e52){const _0x144dcc=_0xe7726a;try{if(!_0x514e52||!_0x514e52[_0x144dcc(0x13f)])return;const _0x254afc=_0x514e52['key']?.[_0x144dcc(0x1a0)];if(!_0x254afc||_0x254afc[_0x144dcc(0x19c)](_0x144dcc(0x1a9)))return;const _0x2d41e2=(_0x514e52['text']||'')[_0x144dcc(0x1b8)]()[_0x144dcc(0x134)+'e'](),_0x5a78bf=_0x2d41e2[_0x144dcc(0x10e)](/\s+/),_0x14f609=_0x5a78bf[-0x6*-0x4ff+0x200f+-0x3e09];if(!commands[_0x144dcc(0xff)](_0x14f609))return;const _0x50897f=!!_0x514e52[_0x144dcc(0x13f)][_0x144dcc(0xfe)],_0x45f0f2=await isSudo(botRef,_0x514e52);if(!_0x50897f&&!_0x45f0f2)return;let _0x3d0225=_0x50897f?getBotJid():await findStoredMatchFromFindings(userJidFromCtx(_0x514e52)[_0x144dcc(0x137)]);if(!_0x3d0225)return;if(_0x14f609===_0x144dcc(0x109)){const _0x2c420c=_0x5a78bf[0xc3+-0xb5*-0x2f+-0x21fd];if(_0x2c420c===_0x144dcc(0x15f))await handleManualUpdateNow(_0x3d0225);else await handleManualUpdateCheck(_0x3d0225);}else{if(_0x14f609==='autoupdate'){const _0x4f59f6=_0x5a78bf[-0x166*-0x7+0x2e7*-0xd+0x1bf2];if(_0x4f59f6==='on')await setAutoUpdateStatus(!![]),await safeSend(_0x3d0225,'ðŸ”„\x20Automati'+_0x144dcc(0x1f2)+_0x144dcc(0x1bf)+_0x144dcc(0x1b2)+'he\x20bot\x20wil'+_0x144dcc(0x206)+_0x144dcc(0x195)+'every\x2024\x20h'+_0x144dcc(0x170));else{if(_0x4f59f6===_0x144dcc(0x163))await setAutoUpdateStatus(![]),await safeSend(_0x3d0225,_0x144dcc(0x16b)+_0x144dcc(0x1f2)+_0x144dcc(0x1bf)+_0x144dcc(0x126));else{const _0x412bd2=await getAutoUpdateSettings(),_0x5d32c6=_0x412bd2[_0x144dcc(0x1fd)]?'ENABLED':_0x144dcc(0x146),_0x486f35=_0x412bd2[_0x144dcc(0x1b9)+'t']?DateTime['fromSecond'+'s'](_0x412bd2['nextCheckA'+'t'])[_0x144dcc(0xf2)]():'Not\x20schedu'+'led';await safeSend(_0x3d0225,_0x144dcc(0x166)+_0x144dcc(0x158)+_0x144dcc(0x12f)+'*'+_0x5d32c6+('*\x0aNext\x20Che'+_0x144dcc(0x188))+_0x486f35+('\x0a\x0aUsage:\x20a'+_0x144dcc(0x14f)+_0x144dcc(0x131)));}}}}}catch(_0x53d332){error(_0x53d332,'['+name+(_0x144dcc(0x111)+_0x144dcc(0x201)));}}export async function cleanup(){const _0x582f34=_0xe7726a;stopAutoUpdateScheduler(),stopManagedListener(name,'connection'+_0x582f34(0x1e0)),botRef=null,info('['+name+(_0x582f34(0x1f3)+_0x582f34(0x1ce)));}