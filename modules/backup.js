const _0x42aa16=_0x3a81;(function(_0x30f913,_0xfd7c81){const _0x5ecf72=_0x3a81,_0x24f803=_0x30f913();while(!![]){try{const _0x47a2c0=parseInt(_0x5ecf72(0x128))/(-0x246+-0x2165+0x23ac)+parseInt(_0x5ecf72(0x1b4))/(-0x1183*-0x1+0x1*0x6f1+0x2a*-0x95)*(parseInt(_0x5ecf72(0xe7))/(-0x3*-0x739+0xbcb*-0x3+-0x1*-0xdb9))+-parseInt(_0x5ecf72(0x123))/(0x2*-0x1085+0x2657+-0x29*0x21)*(parseInt(_0x5ecf72(0x18f))/(0x3*0x58a+-0x1874+0x1*0x7db))+-parseInt(_0x5ecf72(0xcc))/(0x20a5*-0x1+0x11ff+0xeac)+parseInt(_0x5ecf72(0xc4))/(0x2*-0x11a7+-0xe*-0x16+0x2221)*(parseInt(_0x5ecf72(0xe3))/(-0x1*-0x449+-0x4ff*0x7+0x1eb8))+-parseInt(_0x5ecf72(0xc5))/(-0xf*-0xa1+0x212e+0x884*-0x5)*(-parseInt(_0x5ecf72(0x10c))/(0x5*-0x4f1+-0x1740+-0xb*-0x45d))+-parseInt(_0x5ecf72(0x101))/(-0xd83*-0x2+0xba3+-0x1*0x269e)*(parseInt(_0x5ecf72(0x135))/(-0x1184+0x6fb+0x15*0x81));if(_0x47a2c0===_0xfd7c81)break;else _0x24f803['push'](_0x24f803['shift']());}catch(_0xed2e96){_0x24f803['push'](_0x24f803['shift']());}}}(_0x358a,0x1*0xfa031+-0x1*0xf930f+0x20*0x7225));import _0x50f21b from'fs';import _0x11af14 from'path';import{downloadContentFromMessage}from'@whiskeysockets/baileys';import{info,warn,error}from'../utils/logger.js';import{getConfig,findConfigFile,PROJECT_ROOT}from'../utils/config.js';function _0x3a81(_0xfe7367,_0x271cd6){const _0x8c0b9d=_0x358a();return _0x3a81=function(_0x58e722,_0x3fb4b0){_0x58e722=_0x58e722-(0xb*-0x152+-0x95*-0x1f+-0x2c8);let _0x20291c=_0x8c0b9d[_0x58e722];return _0x20291c;},_0x3a81(_0xfe7367,_0x271cd6);}import{getBotJid}from'../utils/bot-state.js';import{userJidFromCtx,listSudo,normalizeToJid}from'../utils/sudo.js';import{shutdownDatabase,initializeDatabase}from'../utils/database.js';export const name=_0x42aa16(0x180);function _0x358a(){const _0x9bcc04=['\x20file\x20exte','in.','\x20DB\x20reinit','ck\x20up\x20new\x20','\x20file\x20does','\x20initializ','eDatabase\x20','.bak_for_s','unlinkSync','ot\x20instanc','writeFileS','isCommand','ld\x20config\x20','rror:\x20','B\x20(downloa','.yml','t\x20to\x20recov','32NCIPuo','etdb','❌\x20Could\x20no','ring\x20resto','10173fiHRUe','fig:\x20','function','.bak_for_g','nce\x20not\x20av','.db','\x20setdb\x20res','fileName','\x20sent\x20DB\x20f','from','kup\x20after\x20','config\x20fil','forEach','❌\x20Invalid\x20','ssage','.json','No\x20media\x20n','idated).','failed\x20aft','existsSync','\x20replaced\x20','.yaml','basename','clear','shutdown\x20c','@g.us','22QkJzSS','\x20may\x20be\x20re','video','\x27\x20authoriz','ode\x20found\x20','imageMessa','omCtx\x20erro','\x20download\x20','\x20.json','er:\x20\x22SQLit','\x20safeSend\x20','7470070iQmQSe','nfig.json','n\x20path.','y\x20attempt\x20','b\x20failure.','stickerMes','quired\x20for','eplaced\x20wi','bot.db','as:\x20','ompleted\x20f','get','\x20some\x20serv','\x20quick\x20cop','\x0aA\x20recover','\x20could\x20not','\x20access\x20de','ync','fig\x20file:\x20','n/octet-st','e\x20format\x203','extname','age','4272KsQuMx','sage','d\x20after\x20sh','ed\x20for\x20','nsions:\x20.y','1488624IvaeVG','vious\x20DB\x20w','ed\x20a\x20DB,\x20r','audioMessa','\x0aAn\x20attemp','\x20failed','⚠️\x20Warning:','text','en\x20DB\x20file','./data/db','videoMessa','contextInf','n\x20WhatsApp','4511208ggePHH','✅\x20Config\x20r','\x20command\x20\x27','o\x20error\x20du','ile:\x20','length','failed:\x20','ilable','e\x20complete','[dbbackup]','sep','toLowerCas','ttach\x20or\x20r','r\x20to\x20be\x20a\x20','split','ream','nied.','\x20failed\x20to','\x20onMessage','remoteJid','join','ailure','o\x20download','is\x20is\x20inde','file\x20to\x20re','edia\x20to\x20do','place\x20the\x20','\x5c0\x22.\x20If\x20th','\x20to\x20','\x20uploaded\x20','quotedMess','isAbsolute','\x20from\x20','string','endsWith','B\x20from\x20bac','o\x20send\x20con','itialized\x20','DB_NAME','config.yml','❌\x20Uploaded','ml,\x20.yaml,','ot\x20restart','resolve','destinatio','valid\x20SQLi',':\x20uploaded','SQLite\x20for','\x20error:\x20','copyFileSy','DB_PATH','the\x20file\x20a','filename\x20/','❌\x20Please\x20a','ill\x20be\x20val','ascii','stringify','sock','d\x20step)','replace','B\x20replaced','2.5.0','applicatio','jid','inalDestFr','has','audio','xtMessage','\x20overwritt','to\x20downloa','getdb','r:\x20','d\x20re-uploa','der\x20mismat','mediaMsg','dbbackup','as\x20made.','\x20DB\x20restor','n/json','mkdirSync','✅\x20Active\x20D','❌\x20Accepted',').\x20Please\x20','eply\x20to\x20a\x20','\x20cleanup\x20e','key','document','bot','pe\x20or\x20no\x20m','ailable.','6990dEoJxF','\x20database\x20','isArray','map','ices\x20to\x20pi','sticker','file\x20heade','d\x20media\x20ty','utf8','\x20cleaned\x20u','\x20DB:\x20','Message','\x20remove\x20ol','ed\x20recover','attempted\x20','ile\x20','y\x20for\x20getd','te\x20DB\x20(hea','re-upload\x20','\x20bot\x20insta','y\x20failed:\x20','config.jso','delete','DB\x20backed\x20','startsWith','\x20restored\x20','\x20expired\x20o','setdb','tension;\x20w','message','trim','\x20getconfig','ialized\x20af','o\x20restore\x20','documentMe','o\x20retrieve','\x20no\x20send\x20s','54uwsSdJ','getconfig','status','Expected\x20S','readFileSy','push','ig\x20file\x20','sendMessag','\x20create\x20DB','setconfig','or\x20getdb\x20o','operation.','d\x20config\x20f','❌\x20Failed\x20t','2792377TuSMCY','18WjCtpv','\x20found:\x20','❌\x20File\x20not','er\x20attempt','\x20removed\x20o','\x20and\x20re-in','extendedTe','8918838xPpjIo','\x20(HTTP\x20410','\x20media\x20has','o\x20save\x20con','text/x-yam','uploaded\x20D'];_0x358a=function(){return _0x9bcc04;};return _0x358a();}export const version=_0x42aa16(0x172);export const priority=0x21c5+0x118*0xc+-0x2e77*0x1;export const commands=[_0x42aa16(0x17b),_0x42aa16(0x1aa),'getconfig','setconfig'];let botRef=null,sendApi=null;const DEDUPE_TTL_MS=(-0x1117+-0xc12*-0x1+0x50f)*(0x28d*0x2+0x6ef*-0x1+0x5bd),processedMessageKeys=new Map();function markProcessed(_0x15d248){const _0x45b415=_0x42aa16;if(!_0x15d248)return;if(processedMessageKeys['has'](_0x15d248))try{clearTimeout(processedMessageKeys[_0x45b415(0x117)](_0x15d248));}catch(_0x14056e){}const _0x391456=setTimeout(()=>processedMessageKeys[_0x45b415(0x1a5)](_0x15d248),DEDUPE_TTL_MS);processedMessageKeys['set'](_0x15d248,_0x391456);}function isProcessed(_0x914c3a){const _0x10fccd=_0x42aa16;return _0x914c3a&&processedMessageKeys[_0x10fccd(0x176)](_0x914c3a);}async function resolveFinalDestFromCtx(_0x4770eb){const _0x341912=_0x42aa16;try{if(!_0x4770eb||!_0x4770eb[_0x341912(0x18a)])return null;const _0x2a5082=getBotJid(),_0x5bc2c9=Boolean(_0x4770eb[_0x341912(0x18a)]['fromMe']);if(_0x5bc2c9)return _0x2a5082||null;const _0x6161b2=String(_0x4770eb[_0x341912(0x18a)][_0x341912(0x148)]||'');if(!_0x6161b2||_0x6161b2[_0x341912(0x157)]('@g.us'))return null;const {findings:_0x210e6c}=userJidFromCtx(_0x4770eb);if(!Array['isArray'](_0x210e6c)||_0x210e6c['length']===-0x21*0x121+0x823*0x4+-0x1*-0x4b5)return null;const _0x58bab7=await listSudo();if(!Array[_0x341912(0x191)](_0x58bab7)||_0x58bab7[_0x341912(0x13a)]===0x1*0x494+0x9b9*0x2+-0x1806)return null;const _0x282ecf=new Set(_0x58bab7[_0x341912(0x192)](_0x22f854=>String(_0x22f854)));for(const _0x1c4c54 of _0x210e6c){if(!_0x1c4c54?.['jid']||typeof _0x1c4c54[_0x341912(0x174)]!=='string')continue;let _0x1403e7=null;try{_0x1403e7=normalizeToJid(_0x1c4c54[_0x341912(0x174)]);}catch(_0x95b136){_0x1403e7=null;}if(_0x1403e7&&_0x282ecf['has'](_0x1403e7))return _0x1403e7;const _0x47241a=(String(_0x1c4c54[_0x341912(0x174)])[_0x341912(0x143)]('@')[0x2184+0x2*-0x2e+-0x2128]||'')[_0x341912(0x143)](':')[0x15a*0x7+-0xebb*0x1+0x545]||null;if(_0x47241a)for(const _0x1d723a of _0x282ecf){const _0x3ac476=String(_0x1d723a)['split']('@')[-0x1*-0x8f9+0xfa4+-0x189d]||null;if(_0x3ac476&&_0x47241a===_0x3ac476)return _0x1d723a;}if(_0x282ecf[_0x341912(0x176)](_0x1c4c54[_0x341912(0x174)]))return _0x1c4c54['jid'];}return null;}catch(_0x19076c){return warn('['+name+(']\x20resolveF'+_0x341912(0x175)+_0x341912(0x107)+_0x341912(0x17c))+(_0x19076c?.[_0x341912(0x1ac)]||_0x19076c)),null;}}function setupSendApi(_0x45f061){const _0x4a7154=_0x42aa16;if(!_0x45f061)return;if(typeof _0x45f061['sendMessag'+'e']===_0x4a7154(0xe9))sendApi=async(_0x1b16e1,_0x30a409)=>await _0x45f061['sendMessag'+'e'](_0x1b16e1,_0x30a409);else _0x45f061[_0x4a7154(0x16e)]&&typeof _0x45f061[_0x4a7154(0x16e)][_0x4a7154(0xbd)+'e']===_0x4a7154(0xe9)?sendApi=async(_0x4c0042,_0x58e7bd)=>await _0x45f061[_0x4a7154(0x16e)][_0x4a7154(0xbd)+'e'](_0x4c0042,_0x58e7bd):sendApi=null;}async function safeSend(_0x45c656,_0xe688db){const _0x3ef799=_0x42aa16;try{if(!_0x45c656||!_0xe688db)return;if(sendApi)return await sendApi(_0x45c656,_0xe688db);warn('[dbbackup]'+_0x3ef799(0x1b3)+'urface\x20ava'+_0x3ef799(0x13c));}catch(_0x26947a){error(_0x26947a,'[dbbackup]'+_0x3ef799(0x10b)+'failed'),warn(_0x3ef799(0x13e)+_0x3ef799(0x10b)+_0x3ef799(0x13b)+(_0x26947a?.[_0x3ef799(0x1ac)]||_0x26947a));}}function resolveDbDir(){const _0x26e77e=_0x42aa16,_0x36f777=getConfig(),_0x5badc4=_0x36f777&&_0x36f777[_0x26e77e(0x167)]?_0x36f777[_0x26e77e(0x167)]:_0x26e77e(0x131),_0xdca97b=_0x11af14[_0x26e77e(0x154)](_0x5badc4)?_0x11af14[_0x26e77e(0x160)](_0x5badc4):_0x11af14['resolve'](PROJECT_ROOT,_0x5badc4);return _0xdca97b;}function ensureInside(_0x327936,_0x2ce34d){const _0x495282=_0x42aa16,_0x5ab452=_0x11af14[_0x495282(0x160)](_0x327936)+_0x11af14[_0x495282(0x13f)],_0x2cb29e=_0x11af14[_0x495282(0x160)](_0x2ce34d);return _0x2cb29e[_0x495282(0x1a7)](_0x5ab452);}function getMediaFromMessage(_0xcb722c){const _0x30af0d=_0x42aa16;if(!_0xcb722c)return null;if(_0xcb722c[_0x30af0d(0x1b1)+_0x30af0d(0xf5)]){const _0x354ba5=_0xcb722c[_0x30af0d(0x1b1)+_0x30af0d(0xf5)];return{'type':'document','mediaMsg':_0xcb722c,'fileName':_0x354ba5[_0x30af0d(0xee)]||null,'caption':_0x354ba5['caption']||null};}if(_0xcb722c[_0x30af0d(0x106)+'ge']||_0xcb722c[_0x30af0d(0x132)+'ge']||_0xcb722c[_0x30af0d(0x12b)+'ge']||_0xcb722c[_0x30af0d(0x111)+_0x30af0d(0x124)]){const _0x50bd29=[_0x30af0d(0x106)+'ge',_0x30af0d(0x132)+'ge',_0x30af0d(0x12b)+'ge','stickerMes'+_0x30af0d(0x124)];for(const _0x43e605 of _0x50bd29){if(_0xcb722c[_0x43e605])return{'type':_0x43e605[_0x30af0d(0x170)](_0x30af0d(0x19a),''),'mediaMsg':_0xcb722c,'fileName':null,'caption':null};}}return null;}function getQuotedMedia(_0x2739db){const _0x42353e=_0x42aa16,_0x13e632=_0x2739db[_0x42353e(0x1ac)]&&_0x2739db[_0x42353e(0x1ac)][_0x42353e(0xcb)+_0x42353e(0x178)];if(!_0x13e632||!_0x13e632['contextInf'+'o']||!_0x13e632[_0x42353e(0x133)+'o']['quotedMess'+_0x42353e(0x122)])return null;const _0x2c8a70=_0x13e632[_0x42353e(0x133)+'o'][_0x42353e(0x153)+_0x42353e(0x122)];return getMediaFromMessage(_0x2c8a70);}async function downloadMessageToBuffer(_0x33fe94){const _0x87f33c=_0x42aa16;if(!_0x33fe94||!_0x33fe94[_0x87f33c(0x1ac)]){const _0x1aa8bb=_0x33fe94,_0x550413=getMediaFromMessage(_0x1aa8bb);if(!_0x550413)throw new Error(_0x87f33c(0xf7)+_0x87f33c(0x105)+_0x87f33c(0x17a)+'d');_0x33fe94={'message':_0x1aa8bb};}const _0x5358bf=_0x33fe94[_0x87f33c(0x1ac)]||{},_0x158ad8=[_0x87f33c(0x18b),'image',_0x87f33c(0x103),'ptv',_0x87f33c(0x177),_0x87f33c(0x194)];for(const _0x15b745 of _0x158ad8){const _0x53356f=_0x5358bf[_0x15b745+_0x87f33c(0x19a)];if(!_0x53356f)continue;const _0x1669f8=await downloadContentFromMessage(_0x53356f,_0x15b745),_0x1143b7=[];for await(const _0x14287c of _0x1669f8)_0x1143b7[_0x87f33c(0x1b9)](_0x14287c);return Buffer['concat'](_0x1143b7);}throw new Error('Unsupporte'+_0x87f33c(0x196)+_0x87f33c(0x18d)+_0x87f33c(0x14e)+'wnload');}export async function initialize(_0x27993f){const _0x461041=_0x42aa16;if(!_0x27993f)throw new Error('dbbackup.i'+'nitialize\x20'+'requires\x20b'+_0x461041(0xdb)+'e');botRef=_0x27993f,setupSendApi(botRef),info(_0x461041(0x13e)+_0x461041(0xd7)+'ed');}export async function onMessage(_0x235b48){const _0x4486f0=_0x42aa16;try{if(!_0x235b48||!_0x235b48['key']||!_0x235b48[_0x4486f0(0x1ac)])return;const _0x1b80e2=String(_0x235b48[_0x4486f0(0x18a)]['remoteJid']||'');if(_0x1b80e2[_0x4486f0(0x157)](_0x4486f0(0x100)))return;const _0x223a76=_0x1b80e2+'::'+String(_0x235b48[_0x4486f0(0x18a)]['id']||'');if(isProcessed(_0x223a76))return;if(!_0x235b48[_0x4486f0(0xdd)])return;const _0x21a55c=_0x235b48[_0x4486f0(0x12f)]&&typeof _0x235b48['text']===_0x4486f0(0x156)?_0x235b48[_0x4486f0(0x12f)][_0x4486f0(0x1ad)]():'';if(!_0x21a55c)return;const _0x4550d8=_0x21a55c[_0x4486f0(0x143)](/\r?\n/)[-0x1a69*-0x1+-0x1321+-0x748]['trim']()[_0x4486f0(0x143)](/\s+/),_0x596c75=(_0x4550d8[-0xc7+0x13c9+0x656*-0x3]||'')['toLowerCas'+'e']();if(!commands['includes'](_0x596c75))return;if(!botRef)botRef=_0x235b48[_0x4486f0(0x18c)]||_0x235b48['client']||null;if(!sendApi)setupSendApi(botRef);if(!botRef){warn(_0x4486f0(0x13e)+_0x4486f0(0x1a2)+_0x4486f0(0xeb)+_0x4486f0(0x18e));return;}const _0x40f8ce=await resolveFinalDestFromCtx(_0x235b48);if(!_0x40f8ce)return;markProcessed(_0x223a76),info(_0x4486f0(0x13e)+_0x4486f0(0x137)+_0x596c75+(_0x4486f0(0x104)+_0x4486f0(0x126))+_0x40f8ce);if(_0x596c75==='getdb'){const _0x4f194a=getConfig(),_0xb2e61e=resolveDbDir(),_0x1d52dc=_0x4f194a&&_0x4f194a[_0x4486f0(0x15b)]?String(_0x4f194a[_0x4486f0(0x15b)]):'bot.db',_0x56dd0e=_0x4550d8[_0x4486f0(0x13a)]>=-0x313*-0x7+-0x3ac+0x1*-0x11d7?_0x4550d8['slice'](-0x3*0x1b+-0x6ef*0x1+0x741)['join']('\x20')['trim']():_0x1d52dc,_0x31943a=_0x11af14['resolve'](_0xb2e61e,_0x56dd0e);if(!ensureInside(_0xb2e61e,_0x31943a)){await safeSend(_0x40f8ce,{'text':_0x4486f0(0xf4)+_0x4486f0(0x169)+_0x4486f0(0x11c)+_0x4486f0(0x145)});return;}if(!_0x50f21b[_0x4486f0(0xfa)](_0x31943a)){await safeSend(_0x40f8ce,{'text':_0x4486f0(0xc7)+_0x4486f0(0xc6)+_0x56dd0e});return;}const _0x24fbbe=_0x11af14[_0x4486f0(0x149)](_0xb2e61e,_0x11af14[_0x4486f0(0xfd)](_0x31943a)+(_0x4486f0(0xea)+'etdb'));let _0x39db3a=![];try{await shutdownDatabase(),_0x39db3a=!![],info(_0x4486f0(0x13e)+'\x20database\x20'+_0x4486f0(0xff)+_0x4486f0(0x116)+_0x4486f0(0xc0)+'peration.');try{_0x50f21b[_0x4486f0(0x166)+'nc'](_0x31943a,_0x24fbbe),info(_0x4486f0(0x13e)+_0x4486f0(0x119)+_0x4486f0(0x19f)+'b\x20at\x20'+_0x24fbbe);}catch(_0xab70e6){warn(_0x4486f0(0x13e)+_0x4486f0(0x119)+_0x4486f0(0x1a3)+(_0xab70e6?.['message']||_0xab70e6));}const _0x3fa1bc=_0x50f21b['readFileSy'+'nc'](_0x31943a);await safeSend(_0x40f8ce,{'document':_0x3fa1bc,'fileName':_0x11af14[_0x4486f0(0xfd)](_0x31943a),'mimetype':_0x4486f0(0x173)+_0x4486f0(0x11f)+_0x4486f0(0x144)}),info('[dbbackup]'+_0x4486f0(0xef)+_0x4486f0(0x19e)+_0x31943a+'\x20to\x20'+_0x40f8ce),await initializeDatabase(),info(_0x4486f0(0x13e)+_0x4486f0(0xd4)+_0x4486f0(0x1af)+'ter\x20getdb\x20'+_0x4486f0(0xc1));}catch(_0x49ca0a){error(_0x49ca0a,_0x4486f0(0x13e)+'\x20getdb\x20fai'+'led');try{_0x39db3a&&(await initializeDatabase(),info(_0x4486f0(0x13e)+_0x4486f0(0xd7)+'eDatabase\x20'+_0x4486f0(0x19d)+'after\x20getd'+_0x4486f0(0x110)));}catch(_0x521c5f){error(_0x521c5f,_0x4486f0(0x13e)+_0x4486f0(0xd7)+_0x4486f0(0xd8)+_0x4486f0(0xf9)+'er\x20getdb\x20f'+_0x4486f0(0x14a));}await safeSend(_0x40f8ce,{'text':_0x4486f0(0xc3)+_0x4486f0(0x1b2)+_0x4486f0(0x199)+(_0x49ca0a?.['message']||_0x49ca0a)+(_0x4486f0(0x11a)+_0x4486f0(0x10f)+'was\x20made.')});}finally{try{if(_0x50f21b['existsSync'](_0x24fbbe))_0x50f21b[_0x4486f0(0xda)](_0x24fbbe);}catch(_0x5a4278){}}return;}if(_0x596c75===_0x4486f0(0x1aa)){let _0xcfbf27=getMediaFromMessage(_0x235b48[_0x4486f0(0x1ac)])||getQuotedMedia(_0x235b48),_0x500f19=!getMediaFromMessage(_0x235b48[_0x4486f0(0x1ac)])&&!!getQuotedMedia(_0x235b48);if(!_0xcfbf27||!_0xcfbf27[_0x4486f0(0x17f)]){await safeSend(_0x40f8ce,{'text':_0x4486f0(0x16a)+'ttach\x20or\x20r'+_0x4486f0(0x188)+_0x4486f0(0x14d)+_0x4486f0(0x14f)+'DB\x20(any\x20ex'+_0x4486f0(0x1ab)+_0x4486f0(0x16b)+_0x4486f0(0xf8)});return;}const _0x35d34a=String(_0xcfbf27[_0x4486f0(0xee)]||'')[_0x4486f0(0x1ad)](),_0x4fe4df=getConfig(),_0x50807f=resolveDbDir();let _0x32eccf=_0x4fe4df&&_0x4fe4df[_0x4486f0(0x15b)]?String(_0x4fe4df[_0x4486f0(0x15b)]):'bot.db',_0xd2ecda=_0x11af14[_0x4486f0(0x121)](_0x32eccf)['toLowerCas'+'e']();if(!_0xd2ecda){_0x32eccf=_0x32eccf||_0x4486f0(0x114),_0xd2ecda=_0x11af14[_0x4486f0(0x121)](_0x32eccf)||_0x4486f0(0xec);if(!_0x11af14[_0x4486f0(0x121)](_0x32eccf))_0x32eccf=''+_0x32eccf+_0xd2ecda;}const _0x3eebe7=_0x11af14['resolve'](_0x50807f,_0x32eccf);try{_0x50f21b[_0x4486f0(0x184)](_0x50807f,{'recursive':!![]});}catch(_0x423cbe){}if(!ensureInside(_0x50807f,_0x3eebe7)){await safeSend(_0x40f8ce,{'text':_0x4486f0(0xf4)+_0x4486f0(0x161)+_0x4486f0(0x10e)});return;}const _0xa83bca=_0x500f19?_0x235b48[_0x4486f0(0x1ac)][_0x4486f0(0xcb)+_0x4486f0(0x178)]['contextInf'+'o'][_0x4486f0(0x153)+_0x4486f0(0x122)]:_0x235b48[_0x4486f0(0x1ac)];let _0x4144f3;try{_0x4144f3=await downloadMessageToBuffer(_0xa83bca);}catch(_0x12d058){error(_0x12d058,_0x4486f0(0x13e)+'\x20failed\x20to'+_0x4486f0(0x108)+_0x4486f0(0xd1)+_0x4486f0(0xe0)+_0x4486f0(0x16f));const _0x43cf46=_0x12d058?.['response']?.['status']||_0x12d058?.[_0x4486f0(0x1b6)]||null;_0x43cf46===-0x9*0x3b1+0x9*0x17f+0x2*0xaae?await safeSend(_0x40f8ce,{'text':_0x4486f0(0xc3)+'o\x20download'+_0x4486f0(0x163)+_0x4486f0(0xce)+_0x4486f0(0x1a9)+_0x4486f0(0x134)+_0x4486f0(0xcd)+_0x4486f0(0x187)+_0x4486f0(0x1a1)+_0x4486f0(0x168)+'nd\x20try\x20aga'+_0x4486f0(0xd3)}):await safeSend(_0x40f8ce,{'text':_0x4486f0(0xc3)+_0x4486f0(0x14b)+_0x4486f0(0x152)+'file:\x20'+(_0x12d058?.[_0x4486f0(0x1ac)]||_0x12d058)});return;}try{const _0x6252f8=_0x4144f3['slice'](0x23b0+-0x13b2*-0x1+-0x3*0x1276,0x63*-0xf+-0x3*0x3e1+-0x40*-0x46),_0x38c4a2=Buffer[_0x4486f0(0xf0)](_0x4486f0(0x164)+'mat\x203\x00',_0x4486f0(0x16c));if(!_0x6252f8['equals'](_0x38c4a2)){await safeSend(_0x40f8ce,{'text':_0x4486f0(0x15d)+_0x4486f0(0xd6)+'\x20not\x20appea'+_0x4486f0(0x142)+_0x4486f0(0x162)+_0x4486f0(0x1a0)+_0x4486f0(0x17e)+'ch).\x0a'+(_0x4486f0(0x1b7)+'QLite\x20head'+_0x4486f0(0x10a)+_0x4486f0(0x120)+_0x4486f0(0x150)+_0x4486f0(0x14c)+_0x4486f0(0x12a)+'e-check\x20an'+_0x4486f0(0x17d)+'d.')});return;}}catch(_0x4c80a9){error(_0x4c80a9,'[dbbackup]'+'\x20header\x20va'+'lidation\x20f'+'ailed'),await safeSend(_0x40f8ce,{'text':_0x4486f0(0xe5)+'t\x20validate'+_0x4486f0(0x152)+_0x4486f0(0x195)+_0x4486f0(0x17c)+(_0x4c80a9?.[_0x4486f0(0x1ac)]||_0x4c80a9)});return;}const _0x2260c7=_0x11af14['join'](_0x50807f,_0x11af14['basename'](_0x3eebe7)+(_0x4486f0(0xd9)+_0x4486f0(0xe4)));let _0x335746=![];try{await shutdownDatabase(),_0x335746=!![],info('[dbbackup]'+_0x4486f0(0x190)+_0x4486f0(0xff)+_0x4486f0(0x116)+'or\x20restore'+'\x20operation'+'.');if(_0x50f21b['existsSync'](_0x3eebe7))try{_0x50f21b['copyFileSy'+'nc'](_0x3eebe7,_0x2260c7),info(_0x4486f0(0x13e)+'\x20existing\x20'+_0x4486f0(0x1a6)+'up\x20to\x20'+_0x2260c7);}catch(_0x5611e4){warn('[dbbackup]'+_0x4486f0(0x146)+_0x4486f0(0xbe)+'\x20backup:\x20'+(_0x5611e4?.['message']||_0x5611e4)),await safeSend(_0x40f8ce,{'text':_0x4486f0(0x12e)+_0x4486f0(0x11b)+_0x4486f0(0xbe)+'\x20backup:\x20'+(_0x5611e4?.[_0x4486f0(0x1ac)]||_0x5611e4)});}_0x50f21b[_0x4486f0(0xdc)+_0x4486f0(0x11d)](_0x3eebe7,_0x4144f3),info('[dbbackup]'+_0x4486f0(0x179)+_0x4486f0(0x130)+'\x20at\x20'+_0x3eebe7),await initializeDatabase(),await safeSend(_0x40f8ce,{'text':_0x4486f0(0x185)+_0x4486f0(0x171)+_0x4486f0(0xca)+_0x4486f0(0x15a)+_0x4486f0(0x115)+_0x11af14['relative'](PROJECT_ROOT,_0x3eebe7)}),info(_0x4486f0(0x13e)+_0x4486f0(0x182)+_0x4486f0(0x13d)+'\x20and\x20DB\x20re'+'initialize'+'d\x20for\x20'+_0x40f8ce);}catch(_0x40f2ae){error(_0x40f2ae,'[dbbackup]'+_0x4486f0(0xed)+'tore\x20faile'+_0x4486f0(0x125)+'utdown');try{_0x50f21b['existsSync'](_0x2260c7)&&(_0x50f21b[_0x4486f0(0x166)+'nc'](_0x2260c7,_0x3eebe7),info('[dbbackup]'+_0x4486f0(0x1a8)+'DB\x20from\x20ba'+'ckup\x20due\x20t'+_0x4486f0(0x138)+_0x4486f0(0xe6)+'re'));}catch(_0x317ab5){error(_0x317ab5,_0x4486f0(0x13e)+_0x4486f0(0x146)+'\x20restore\x20D'+_0x4486f0(0x158)+_0x4486f0(0xf1)+'error');}try{await initializeDatabase();}catch(_0x3faf2d){error(_0x3faf2d,'[dbbackup]'+_0x4486f0(0xd7)+_0x4486f0(0xd8)+_0x4486f0(0xf9)+_0x4486f0(0xc8)+_0x4486f0(0x19c)+'y');}await safeSend(_0x40f8ce,{'text':_0x4486f0(0xc3)+_0x4486f0(0x1b0)+'DB:\x20'+(_0x40f2ae?.[_0x4486f0(0x1ac)]||_0x40f2ae)+(_0x4486f0(0x12c)+_0x4486f0(0xe2)+'er\x20the\x20pre'+_0x4486f0(0x129)+_0x4486f0(0x181))});}finally{try{if(_0x50f21b[_0x4486f0(0xfa)](_0x2260c7))_0x50f21b[_0x4486f0(0xda)](_0x2260c7);}catch(_0x24aefb){}}return;}if(_0x596c75===_0x4486f0(0x1b5)){const _0x2b7285=findConfigFile();if(_0x2b7285){try{const _0x577bcc=_0x50f21b[_0x4486f0(0x1b8)+'nc'](_0x2b7285),_0x1f82e1=_0x2b7285[_0x4486f0(0x140)+'e']()[_0x4486f0(0x157)]('.json')?_0x4486f0(0x173)+'n/json':_0x4486f0(0xd0)+'l';await safeSend(_0x40f8ce,{'document':_0x577bcc,'fileName':_0x11af14[_0x4486f0(0xfd)](_0x2b7285),'mimetype':_0x1f82e1}),info(_0x4486f0(0x13e)+'\x20sent\x20conf'+_0x4486f0(0x1ba)+_0x2b7285+_0x4486f0(0x151)+_0x40f8ce);}catch(_0x155f06){error(_0x155f06,_0x4486f0(0x13e)+_0x4486f0(0x1ae)+'\x20send\x20fail'+'ed'),await safeSend(_0x40f8ce,{'text':_0x4486f0(0xc3)+_0x4486f0(0x159)+_0x4486f0(0x11e)+(_0x155f06?.[_0x4486f0(0x1ac)]||_0x155f06)});}return;}const _0x1e52c2=getConfig()||{},_0x48624c=Buffer[_0x4486f0(0xf0)](JSON[_0x4486f0(0x16d)](_0x1e52c2,null,0x892+0xcdf+-0x3*0x725),_0x4486f0(0x197));await safeSend(_0x40f8ce,{'document':_0x48624c,'fileName':'runtime-co'+_0x4486f0(0x10d),'mimetype':_0x4486f0(0x173)+_0x4486f0(0x183)});return;}if(_0x596c75===_0x4486f0(0xbf)){let _0xcae69e=getMediaFromMessage(_0x235b48[_0x4486f0(0x1ac)])||getQuotedMedia(_0x235b48),_0x21c6c2=!getMediaFromMessage(_0x235b48['message'])&&!!getQuotedMedia(_0x235b48);if(!_0xcae69e||!_0xcae69e[_0x4486f0(0x17f)]){await safeSend(_0x40f8ce,{'text':_0x4486f0(0x16a)+_0x4486f0(0x141)+_0x4486f0(0x188)+_0x4486f0(0xf2)+'e.'});return;}const _0x5223db=String(_0xcae69e[_0x4486f0(0xee)]||'')[_0x4486f0(0x1ad)]()['toLowerCas'+'e'](),_0x38f637=[_0x4486f0(0xe1),_0x4486f0(0xfc),'.json'],_0x1fb4d5=_0x11af14[_0x4486f0(0x121)](_0x5223db||'');if(!_0x38f637['includes'](_0x1fb4d5)){await safeSend(_0x40f8ce,{'text':_0x4486f0(0x186)+_0x4486f0(0xd2)+_0x4486f0(0x127)+_0x4486f0(0x15e)+_0x4486f0(0x109)});return;}const _0x4409e9=findConfigFile(),_0x3c60ee=_0x1fb4d5===_0x4486f0(0xf6)?_0x4486f0(0x1a4)+'n':_0x4486f0(0x15c),_0xc97a93=_0x11af14[_0x4486f0(0x160)](PROJECT_ROOT,_0x3c60ee);if(!ensureInside(PROJECT_ROOT,_0xc97a93)){await safeSend(_0x40f8ce,{'text':_0x4486f0(0xf4)+_0x4486f0(0x161)+_0x4486f0(0x10e)});return;}try{const _0x4ccfba=_0x21c6c2?_0x235b48[_0x4486f0(0x1ac)][_0x4486f0(0xcb)+_0x4486f0(0x178)][_0x4486f0(0x133)+'o']['quotedMess'+_0x4486f0(0x122)]:_0x235b48[_0x4486f0(0x1ac)],_0x178cc7=await downloadMessageToBuffer(_0x4ccfba);_0x50f21b[_0x4486f0(0xdc)+_0x4486f0(0x11d)](_0xc97a93,_0x178cc7,{'encoding':_0x4486f0(0x197)});if(_0x4409e9&&_0x4409e9!==_0xc97a93&&_0x50f21b[_0x4486f0(0xfa)](_0x4409e9))try{_0x50f21b[_0x4486f0(0xda)](_0x4409e9),info('[dbbackup]'+_0x4486f0(0xc9)+_0x4486f0(0xde)+'file:\x20'+_0x4409e9);}catch(_0x32a85c){warn('[dbbackup]'+_0x4486f0(0x11b)+_0x4486f0(0x19b)+_0x4486f0(0xc2)+_0x4486f0(0x139)+(_0x32a85c?.[_0x4486f0(0x1ac)]||_0x32a85c));}await safeSend(_0x40f8ce,{'text':_0x4486f0(0x136)+_0x4486f0(0x113)+'th:\x20'+_0x3c60ee+('\x0aNote:\x20A\x20b'+_0x4486f0(0x15f)+_0x4486f0(0x102)+_0x4486f0(0x112)+_0x4486f0(0x118)+_0x4486f0(0x193)+_0x4486f0(0xd5)+'config.')}),info(_0x4486f0(0x13e)+_0x4486f0(0xfb)+_0x4486f0(0xf2)+'e\x20'+_0xc97a93+_0x4486f0(0x155)+_0x40f8ce);}catch(_0x1be8e9){error(_0x1be8e9,_0x4486f0(0x13e)+'\x20setconfig'+_0x4486f0(0x12d)),await safeSend(_0x40f8ce,{'text':_0x4486f0(0xc3)+_0x4486f0(0xcf)+_0x4486f0(0xe8)+(_0x1be8e9?.[_0x4486f0(0x1ac)]||_0x1be8e9)});}return;}}catch(_0x191a39){error(_0x191a39,_0x4486f0(0x13e)+_0x4486f0(0x147)+_0x4486f0(0x165)+(_0x191a39?.[_0x4486f0(0x1ac)]||_0x191a39));}}export async function cleanup(){const _0x1f1379=_0x42aa16;try{botRef=null,sendApi=null,processedMessageKeys[_0x1f1379(0xf3)](_0x190200=>{try{clearTimeout(_0x190200);}catch(_0x3f8d4e){}}),processedMessageKeys[_0x1f1379(0xfe)](),info(_0x1f1379(0x13e)+_0x1f1379(0x198)+'p');}catch(_0x5d02f3){warn(_0x1f1379(0x13e)+_0x1f1379(0x189)+_0x1f1379(0xdf)+(_0x5d02f3?.[_0x1f1379(0x1ac)]||_0x5d02f3));}}export default{'name':name,'version':version,'priority':priority,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};